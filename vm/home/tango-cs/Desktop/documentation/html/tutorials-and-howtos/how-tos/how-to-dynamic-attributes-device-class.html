

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to add dynamic attributes to a device class &mdash; Tango Controls 9.2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Tango Controls 9.2.5 documentation" href="../../index.html"/>
        <link rel="up" title="HOW-TOs" href="index.html"/>
        <link rel="next" title="How to extract read and set values from a scalar attribute" href="how-to-extract-scalar-attribute.html"/>
        <link rel="prev" title="How to distinguish clients on the server side" href="how-to-distinguish-clients-on-the-server-side.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../contents.html" class="icon icon-home"> Tango Controls
          

          
            
            <img src="../../_static/logo_tangocontrols_white.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                9.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome to Tango Controls documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools-and-extensions/index.html">Tools and Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/index.html">Administration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tutorials and How-Tos</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">HOW-TOs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="how-to-compile-mniorb.html">How to cross compile omniORB</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-create-inheritance-link.html">How to create inheritance link between Tango classes (C++)</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-deal-string-tango-attribute-cpp.html">How to deal with string Tango attribute (C++)</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-device-server-startup-time.html">How to reconnect Database at device server startup time</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-distinguish-clients-on-the-server-side.html">How to distinguish clients on the server side</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">How to add dynamic attributes to a device class</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-extract-scalar-attribute.html">How to extract read and set values from a scalar attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-fandango.html">How to Fandango</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-first-device-class.html">How to write your first Device Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-import-classes-to-catalogue.html">How to import multiple device classes to the Catalogue</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-integrate-java-server-with-astor.html">Integrate Java Tango servers with Astor</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-integrate-with-systemd.html">Tango with systemd integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-pytango.html">How to PyTango</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-pytangoarchiving.html">PyTangoArchiving Recipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-run-device-server-firewall.html">How to run a device server with an active Windows firewall</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-run-device-servers-on-XP-with-IPv6.html">How to run device servers on Windows XP with IPv6</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-start-device-server.html">How to start a device server</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-try-tango.html">How to try Tango Controls</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-to-use-tango-servers-without-db.html">Using Tango servers without DB for unit testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-tune-polling-code-tango-class.html">How to tune polling by code in a TANGO class</a></li>
<li class="toctree-l3"><a class="reference internal" href="how-use-vectors-set-attributes.html">How to use vectors to set attributes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">Tango Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Tutorials and How-Tos</a> &raquo;</li>
        
          <li><a href="index.html">HOW-TOs</a> &raquo;</li>
        
      <li>How to add dynamic attributes to a device class</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials-and-howtos/how-tos/how-to-dynamic-attributes-device-class.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-add-dynamic-attributes-to-a-device-class">
<h1>How to add dynamic attributes to a device class<a class="headerlink" href="#how-to-add-dynamic-attributes-to-a-device-class" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-new-attributes-at-startup">
<h2>Creating new attributes at Startup<a class="headerlink" href="#creating-new-attributes-at-startup" title="Permalink to this headline">¶</a></h2>
<p>by Sergi Rubio Manrique, <a class="reference external" href="mailto:srubio&#37;&#52;&#48;cells&#46;es">srubio<span>&#64;</span>cells<span>&#46;</span>es</a>, with help from&nbsp;R.Bourtembourg
and E.Taurel.</p>
<p>Do you need to create more or less Attributes depending on a certain
device property? Are you interested in changing the name/type/dimensions
of your attributes depending on different applications?</p>
<p>That is common while working with Input/Output devices with a variable
number of channels (PLCs, DaqBoards, Timers/Counters), when depending of
the operation mode more or less scalar or spectrum attributes could be
needed.</p>
<p>This brief&nbsp;<strong>HowTo</strong>&nbsp;implements this feature in a Tango class base on
code generated by&nbsp;<strong>Pogo 8</strong>.</p>
</div>
<div class="section" id="generating-your-class-with-pogo">
<h2>Generating your class with Pogo<a class="headerlink" href="#generating-your-class-with-pogo" title="Permalink to this headline">¶</a></h2>
<p><strong>DynAttr</strong></p>
<p>with three types of attributes:</p>
<ol class="arabic simple">
<li>StaticAttr: A scalar, Tango::DevShort, READ attribute,</li>
<li>LongDynAttr: A scalar, Tango::DevLong, READ_WRITE attribute,</li>
<li>DoubleDynAttr: A scalar, Tango::DevDouble, READ_WRITE attribute.</li>
</ol>
<p>Each device belonging to this class has one StaticAttr and a dynamic
list of LongDynAttr or DoubleDynAttr attributes. This list of dynamic
attributes is defined with a device property named&nbsp;<strong>DynAttrList</strong></p>
<p>Therefore, using Pogo, we define a Tango class with three scalar
attributes with the definition given above. We also create the
DynAttrList property for defining dynamic attribute. This is a vector of
strings with a couple of strings for each attribute. The first string is
the dynamic attribute type (LongDynAttr or DoubleDynAttr) and the second
string is the attribute name.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The dynamic attributes have a light green background
color on the main Pogo window.</p>
</div>
<div class="figure align-center">
<img alt="../../_images/pogo-dynattr.jpg" src="../../_images/pogo-dynattr.jpg" />
</div>
</div>
<div class="section" id="implementing-the-dynamic-attributes">
<h2>Implementing the Dynamic Attributes<a class="headerlink" href="#implementing-the-dynamic-attributes" title="Permalink to this headline">¶</a></h2>
<p>Pogo 8 has been modified to help user to create Tango class with dynamic
attribute(s).</p>
<div class="section" id="dynamic-attribute-registration">
<h3>Dynamic attribute registration<a class="headerlink" href="#dynamic-attribute-registration" title="Permalink to this headline">¶</a></h3>
<p>To register device dynamic attribute, you need to:</p>
<ol class="arabic simple">
<li>call the Tango::DeviceImpl::add_attribute() method for each device dynamic attribute.</li>
<li>create the data used with the attribute (for the Attribute::set_value() method).</li>
</ol>
<p>Pogo generates method(s) named <strong>DynAttr::add_&lt;Dyn attr class name&gt;_dynamic_attribute(string att_name)</strong>
which do this job for you. You have to call these methods
according to your needs in another Pogo generated method
named&nbsp;<strong>DynAttr::add_dynamic_attributes()</strong>&nbsp;which
is executed at device creation time.
In our example, in this method we have to:</p>
<ul class="simple">
<li>analyze the content of the device DynAttrList property and create
the necessary attributes using the helper method also generated by
Pogo</li>
</ul>
<p>The code of the DynAttr::add_dynamic_attributes() method looks like</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span>void DynAttr::add_dynamic_attributes()
{
    //  Example to add dynamic attribute:
    //  add_LongDynAttr_dynamic_attribute(&quot;MyAttribute&quot;);
    //  add_DoubleDynAttr_dynamic_attribute(&quot;MyAttribute&quot;);

    /*----- PROTECTED REGION ID(DynAttr::add_dynamic_attributes) ENABLED START -----*/

    if (dynAttrList.empty() == false)
    {
    if ((dynAttrList.size() % 2) != 0)
    {
// Throw exception
    }

    for (unsigned int i = 0;i &lt; dynAttrList.size();i = i + 2)
    {
        if (dynAttrList[i] == &quot;LongDynAttr&quot;)
        {
        add_LongDynAttr_dynamic_attribute(dynAttrList[i + 1]);
        }
        else if (dynAttrList[i] == &quot;DoubleDynAttr&quot;)
        {
        add_DoubleDynamicAttr_dynamic_attribute(dynAttrList[i + 1]);
        }
        else
        {
// Throw exception
        }
    }
    }

    /*----- PROTECTED REGION END -----*/    //  DynAttr::add_dynamic_attributes
</pre></div>
</td></tr></table></div>
<p>The code to throw exception has been removed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The data associated with all LongDynAttr dynamic attributes
are initialized to 0 and the data associated to all DoubleDynAttr
dynamic attributes are initialized with 0.0</p>
</div>
<p>The definition of the DoubleDynAttr attribute is simply to return when
read, the last value which has been written. The code for the
DoubleDynAttr reading/writing is the following</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span>void DynAttr::read_DoubleDynAttr(Tango::Attribute &amp;attr)
{
    DEBUG_STREAM &lt;&lt; &quot;DynAttr::read_DoubleDynAttr(Tango::Attribute &amp;attr) entering... &quot; &lt;&lt; endl;
    Tango::DevDouble *att_value = get_DoubleDynAttr_data_ptr(attr.get_name());

    /*----- PROTECTED REGION ID(DynAttr::read_DoubleDynAttr) ENABLED START -----*/

    //  Set the attribute value
    attr.set_value(att_value);

    /*----- PROTECTED REGION END -----*/    //  DynAttr::read_DoubleDynAttr
}

void DynAttr::write_DoubleDynAttr(Tango::WAttribute &amp;attr)
{
    DEBUG_STREAM &lt;&lt; &quot;DynAttr::write_DoubleDynAttr(Tango::Attribute &amp;attr) entering... &quot; &lt;&lt; endl;

    //  Retrieve write value
    Tango::DevDouble    w_val;
    attr.get_write_value(w_val);

    /*----- PROTECTED REGION ID(DynAttr::write_DoubleDynAttr) ENABLED START -----*/

    Tango::DevDouble *att_value = get_DoubleDynAttr_data_ptr(attr.get_name());
    *att_value = w_val;

    /*----- PROTECTED REGION END -----*/    //  DynAttr::write_DoubleDynAttr
}
</pre></div>
</td></tr></table></div>
<p>The code of the read method in it’s Pogo generated part retrieves a
pointer to the data associated with this attribute with the helper
method named&nbsp;<strong>DynAttr::get_&lt;Dyn attr class name&gt;_data_ptr(sting att_name)</strong>. The user code simply pass this
pointer&nbsp; to the Tango Attribute::set_value() method.</p>
<p>The user code of the write method also uses the Pogo generated helper
method to get the attribute data pointer and set this data to the value
sent by the caller.</p>
<p>The definition of the LongDynAttr is a bit more sophisticated. For one
device of this Tango class, we have several dynamic attributes of this
LongDynAttr type. According to which attribute is read or written, we
have to call different method accessing the hardware.</p>
<p>The code for reading/writing the LongDynAttr attribute is given below:</p>
<div class="highlight-cpp"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span>void DynAttr::read_LongDynAttr(Tango::Attribute &amp;attr)
{
    DEBUG_STREAM &lt;&lt; &quot;DynAttr::read_LongDynAttr(Tango::Attribute &amp;attr) entering... &quot; &lt;&lt; endl;
    Tango::DevLong *att_value = get_LongDynAttr_data_ptr(attr.get_name());

    /*----- PROTECTED REGION ID(DynAttr::read_LongDynAttr) ENABLED START -----*/

    string &amp;att_name = attr.get_name();
    if (att_name == dynAttrList[1])
    *att_value = read_hardware_channel1();  // Access hardware for channel 1 which is the first attribute in the list
    else if (att_name == dynAttrList[3])
    *att_value = read_hardware_channel2();  // Access hardware for channel 2 which is the second attribute in the list
    else
    {
// Throw exception
    }

    //  Set the attribute value
    attr.set_value(att_value);

    /*----- PROTECTED REGION END -----*/    //  DynAttr::read_LongDynAttr
}

void DynAttr::write_LongDynAttr(Tango::WAttribute &amp;attr)
{
    DEBUG_STREAM &lt;&lt; &quot;DynAttr::write_LongDynAttr(Tango::Attribute &amp;attr) entering... &quot; &lt;&lt; endl;

    //  Retrieve write value
    Tango::DevLong  w_val;
    attr.get_write_value(w_val);

    /*----- PROTECTED REGION ID(DynAttr::write_LongDynAttr) ENABLED START -----*/

    string &amp;att_name = attr.get_name();
    if (att_name == dynAttrList[1])
    write_hardware_channel1(w_val); // Access hardware for channel 1 which is the first attribute in the list
    else if (att_name == dynAttrList[3])
    write_hardware_channel2(w_val); // Access hardware for channel 2 which is the second attribute in the list
    else
    {
// Throw exception
    }

    /*----- PROTECTED REGION END -----*/    //  DynAttr::write_LongDynAttr
}
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="running-the-server">
<h2>Running the server<a class="headerlink" href="#running-the-server" title="Permalink to this headline">¶</a></h2>
<p>A Tango device server process hosting this DynAttr class has been
defined in the database with two device. The dynamic attributes for
these two devices are:</p>
<div class="figure align-center">
<img alt="../../_images/jive-dev1.jpg" src="../../_images/jive-dev1.jpg" />
</div>
<div class="figure align-center">
<img alt="../../_images/prop_dev2.jpg" src="../../_images/prop_dev2.jpg" />
</div>
<p>As shown by the Pogo screen-shot in the beginning of this HowTo, the
Tango class also defines a static attribute for each device named
StaticAttr. Running the device server and opening TestDevice panels on
each device displays device attribute list:</p>
<div class="figure align-center">
<img alt="../../_images/test-dev1.jpg" src="../../_images/test-dev1.jpg" />
</div>
<div class="figure align-center">
<img alt="../../_images/test_device2.jpg" src="../../_images/test_device2.jpg" />
</div>
<p>This method fully supports restarting device(s) or server using the
device server process admin device.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Pogo 8 simplifies a lot the code needed to write Tango class with
dynamic attributes. Restarting device(s) from the admin device is fully
supported.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="how-to-extract-scalar-attribute.html" class="btn btn-neutral float-right" title="How to extract read and set values from a scalar attribute" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="how-to-distinguish-clients-on-the-server-side.html" class="btn btn-neutral" title="How to distinguish clients on the server side" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tango Community, Creative Commons Attribution 4.0 International (CC BY 4.0).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'9.2.5',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>