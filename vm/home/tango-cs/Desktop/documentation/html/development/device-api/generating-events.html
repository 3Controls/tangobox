

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Generating events in a device server &mdash; Tango Controls 9.2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Tango Controls 9.2.5 documentation" href="../../index.html"/>
        <link rel="up" title="Device Servers" href="index.html"/>
        <link rel="next" title="Tango Device in Java" href="java/index.html"/>
        <link rel="prev" title="Device polling" href="device-polling.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../contents.html" class="icon icon-home"> Tango Controls
          

          
            
            <img src="../../_static/logo_tangocontrols_white.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                9.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome to Tango Controls documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-guidelines/index.html">General guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../corba.html">10 things you should know about CORBA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client-api/index.html">Tango Client</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Device Servers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">Introduction to device server</a></li>
<li class="toctree-l3"><a class="reference internal" href="ds-guideline/index.html">TANGO Device Server Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="device-server-model.html">The TANGO device server model</a></li>
<li class="toctree-l3"><a class="reference internal" href="device-server-writing.html">Writing a TANGO device server</a></li>
<li class="toctree-l3"><a class="reference internal" href="attribute-alarms.html">Attribute alarms</a></li>
<li class="toctree-l3"><a class="reference internal" href="enumerated-attribute.html">Enumerated attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="memorized-attribute.html">Memorized attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="forwarded-attribute.html">Forwarded attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="device-polling.html">Device polling</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generating events in a device server</a></li>
<li class="toctree-l3"><a class="reference internal" href="java/index.html">Tango Device in Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="python/index.html">PyTango - a Python binding to Tango</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../debugging-and-testing/index.html">Debugging and Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/index.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpp-api/index.html">Tango Core C++ Classes Reference Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools-and-extensions/index.html">Tools and Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-howtos/index.html">Tutorials and How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">Tango Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">Device Servers</a> &raquo;</li>
        
      <li>Generating events in a device server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/development/device-api/generating-events.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="generating-events-in-a-device-server">
<h1>Generating events in a device server<a class="headerlink" href="#generating-events-in-a-device-server" title="Permalink to this headline">¶</a></h1>
<p>The server is at the origin of events. It will fire events as soon as
they occur. Standard events (<em>change</em>, <em>periodic</em> and <em>archive</em>) are
detected automatically in the polling thread and fired as soon as they
are detected. The <em>periodic</em> events can only be handled by the polling
thread. <em>Change, Data ready</em> and <em>archive</em> events can also be pushed
from the device server code. To allow a client to subscribe to events of
non polled attributes the server has to declare that events are pushed
from the code. Three methods are available for this purpose:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">Attr</span><span class="operator">::</span><span class="name">set_change_event</span><span class="punctuation">(</span><span class="keyword type">bool</span> <span class="name">implemented</span><span class="punctuation">,</span> <span class="keyword type">bool</span> <span class="name">detect</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">2 </span>  <span class="name">Attr</span><span class="operator">::</span><span class="name">set_archive_event</span><span class="punctuation">(</span><span class="keyword type">bool</span> <span class="name">implemented</span><span class="punctuation">,</span> <span class="keyword type">bool</span> <span class="name">detect</span> <span class="operator">=</span> <span class="name builtin">true</span><span class="punctuation">);</span>
<span class="ln">3 </span>  <span class="name">Attr</span><span class="operator">::</span><span class="name">set_data_ready_event</span><span class="punctuation">(</span> <span class="keyword type">bool</span> <span class="name">implemented</span><span class="punctuation">);</span>
</pre>
<p>where <em>implemented</em>=true indicates that events are pushed manually
from the code and <em>detect</em>=true (when used) triggers the verification
of the same event properties as for events send by the polling thread.
When setting <em>detect</em>=false, no value checking is done on the pushed
value! The class DeviceImpl also supports the first two methods with an
addictional parameter attr_name defining the attribute name.</p>
<p>To push events manually from the code a set of data type dependent
methods can be used:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_change_event</span> <span class="punctuation">(</span><span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span> <span class="punctuation">....);</span>
<span class="ln">2 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_archive_event</span><span class="punctuation">(</span><span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span> <span class="punctuation">....);</span>
</pre>
<p>For the data ready event, a DeviceImpl class method has to be used to
push the event.</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_data_ready_event</span><span class="punctuation">(</span><span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span> <span class="name">ctr</span><span class="punctuation">);</span>
</pre>
<p>See the class documentation for all available interfaces.</p>
<p>For non-standard events a single call exists for pushing the data to the
CORBA Notification Service (omniNotify). Clients who are subscribed to
this event have to know what data type is in the DeviceAttribute and
unpack it accordingly.</p>
<p>To push non-standard events, use the following api call is available to
all device servers :</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span>  <span class="name">DeviceImpl</span><span class="operator">::</span><span class="name">push_event</span><span class="punctuation">(</span> <span class="name">string</span> <span class="name">attr_name</span><span class="punctuation">,</span>
<span class="ln">2 </span>               <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">filterable_names</span><span class="punctuation">,</span>
<span class="ln">3 </span>               <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">filterable_vals</span><span class="punctuation">,</span>
<span class="ln">4 </span>               <span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">att</span><span class="punctuation">)</span>
</pre>
<p>where <em>attr_name</em> is the name of the attribute<em>. Filterable_names</em>
and <em>filterable_vals</em> represent any filterable data which can be used
by clients to filter on. Here is a typical example of what a server will
need to do to send its own events. We are in the read method of the
Sinusoide attribute. This attribute is readable as any other attribute
but an event is sent if its value is positive when it is read. On top of
that, this event is sent with one filterable field called value which is
set to the attribute value.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">void</span> <span class="name">MyClass</span><span class="operator">::</span><span class="name">read_Sinusoide</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>    <span class="punctuation">...</span>
<span class="ln"> 4 </span>       <span class="keyword">struct</span> <span class="name">timeval</span> <span class="name">tv</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>       <span class="name">gettimeofday</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">tv</span><span class="punctuation">,</span> <span class="name builtin">NULL</span><span class="punctuation">);</span>
<span class="ln"> 6 </span>       <span class="name">sinusoide</span> <span class="operator">=</span> <span class="literal number integer">100</span> <span class="operator">*</span> <span class="name">sin</span><span class="punctuation">(</span> <span class="literal number integer">2</span> <span class="operator">*</span> <span class="literal number float">3.14</span> <span class="operator">*</span> <span class="name">frequency</span> <span class="operator">*</span> <span class="name">tv</span><span class="punctuation">.</span><span class="name">tv_sec</span><span class="punctuation">);</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span>       <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">sinusoide</span> <span class="operator">&gt;=</span> <span class="literal number integer">0</span><span class="punctuation">)</span>
<span class="ln"> 9 </span>       <span class="punctuation">{</span>
<span class="ln">10 </span>          <span class="name">vector</span><span class="operator">&lt;</span><span class="name">string</span><span class="operator">&gt;</span> <span class="name">filterable_names</span><span class="punctuation">;</span>
<span class="ln">11 </span>          <span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">double</span><span class="operator">&gt;</span> <span class="name">filterable_value</span><span class="punctuation">;</span>
<span class="ln">12 </span>
<span class="ln">13 </span>          <span class="name">filterable_names</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">(</span><span class="literal string">&quot;value&quot;</span><span class="punctuation">);</span>
<span class="ln">14 </span>          <span class="name">filterable_value</span><span class="punctuation">.</span><span class="name">push_back</span><span class="punctuation">((</span><span class="keyword type">double</span><span class="punctuation">)</span><span class="name">sinusoide</span><span class="punctuation">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>          <span class="name">push_event</span><span class="punctuation">(</span> <span class="name">attr</span><span class="punctuation">.</span><span class="name">get_name</span><span class="punctuation">(),</span>
<span class="ln">17 </span>                      <span class="name">filterable_names</span><span class="punctuation">,</span> <span class="name">filterable_value</span><span class="punctuation">,</span>
<span class="ln">18 </span>                      <span class="operator">&amp;</span><span class="name">sinusoide</span><span class="punctuation">);</span>
<span class="ln">19 </span>       <span class="punctuation">}</span>
<span class="ln">20 </span>    <span class="punctuation">....</span>
<span class="ln">21 </span>    <span class="punctuation">....</span>
<span class="ln">22 </span>
<span class="ln">23 </span> <span class="punctuation">}</span>
</pre>
<p>line 13-14 : The filter pair name/value is initialised</p>
<p>line 16-18 : The event is pushed</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="java/index.html" class="btn btn-neutral float-right" title="Tango Device in Java" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="device-polling.html" class="btn btn-neutral" title="Device polling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tango Community, Creative Commons Attribution 4.0 International (CC BY 4.0).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'9.2.5',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>