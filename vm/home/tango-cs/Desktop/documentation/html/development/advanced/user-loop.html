

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Device server with user defined event loop &mdash; Tango Controls 9.2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Tango Controls 9.2.5 documentation" href="../../index.html"/>
        <link rel="up" title="Advanced" href="index.html"/>
        <link rel="next" title="Tango Device Server Model" href="TangoDeviceServerModel.html"/>
        <link rel="prev" title="Transferring images" href="transferring-images.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../contents.html" class="icon icon-home"> Tango Controls
          

          
            
            <img src="../../_static/logo_tangocontrols_white.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                9.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome to Tango Controls documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-guidelines/index.html">General guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../corba.html">10 things you should know about CORBA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client-api/index.html">Tango Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-api/index.html">Device Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging-and-testing/index.html">Debugging and Testing</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Advanced</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="threading.html">Threading</a></li>
<li class="toctree-l3"><a class="reference internal" href="transferring-images.html">Transferring images</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Device server with user defined event loop</a></li>
<li class="toctree-l3"><a class="reference internal" href="TangoDeviceServerModel.html">Tango Device Server Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html">Tango REST API</a></li>
<li class="toctree-l3"><a class="reference internal" href="IDL.html">The TANGO IDL file : Module Tango</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference.html">Reference part</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cpp-api/index.html">Tango Core C++ Classes Reference Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools-and-extensions/index.html">Tools and Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-howtos/index.html">Tutorials and How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">Tango Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">Advanced</a> &raquo;</li>
        
      <li>Device server with user defined event loop</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/development/advanced/user-loop.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="device-server-with-user-defined-event-loop">
<span id="user-loop"></span><h1>Device server with user defined event loop<a class="headerlink" href="#device-server-with-user-defined-event-loop" title="Permalink to this headline">¶</a></h1>
<p>Sometimes, it could be usefull to write your own process event handling
loop. For instance, this feature can be used in a device server process
where the ORB is only one of several components that must perform event
handling. A device server with a graphical user interface must allow the
GUI to handle windowing events in addition to allowing the ORB to handle
incoming requests. These types of device server therefore perform
non-blocking event handling. They turn the main thread of control over
each of the vvarious event-handling sub-systems while not allowing any
of them to block for significants period of time. The <em>Tango::Util</em>
class has a method called <em>server_set_event_loop()</em> to deal with such
a case. This method has only one argument which is a function pointer.
This function does not receive any argument and returns a boolean. If
this boolean is true, the device server process exits. The device server
core will call this function in a loop without any sleeping time between
the call. It is the user responsability to implement in this function
some kind of sleeping mechanism in order not to make this loop too CPU
consuming. The code of this function is executed by the device server
main thread. The following piece of code is an example of how you can
use this feature.</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="keyword type">bool</span> <span class="name function">my_event_loop</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="keyword type">bool</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span>     <span class="name">some_sleeping_time</span><span class="punctuation">();</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span>     <span class="name">ret</span> <span class="operator">=</span> <span class="name">handle_gui_events</span><span class="punctuation">();</span>
<span class="ln"> 8 </span>
<span class="ln"> 9 </span>     <span class="keyword">return</span> <span class="name">ret</span><span class="punctuation">;</span>
<span class="ln">10 </span>  <span class="punctuation">}</span>
<span class="ln">11 </span>
<span class="ln">12 </span>  <span class="keyword type">int</span> <span class="name function">main</span><span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">argc</span><span class="punctuation">,</span><span class="keyword type">char</span> <span class="operator">*</span><span class="name">argv</span><span class="punctuation">[])</span>
<span class="ln">13 </span>  <span class="punctuation">{</span>
<span class="ln">14 </span>     <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span> <span class="operator">*</span><span class="name">tg</span><span class="punctuation">;</span>
<span class="ln">15 </span>     <span class="keyword">try</span>
<span class="ln">16 </span>     <span class="punctuation">{</span>
<span class="ln">17 </span>        <span class="comment single">// Initialise the device server
</span><span class="ln">18 </span><span class="comment single"></span>        <span class="comment single">//----------------------------------------
</span><span class="ln">19 </span><span class="comment single"></span>        <span class="name">tg</span> <span class="operator">=</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">Util</span><span class="operator">::</span><span class="name">init</span><span class="punctuation">(</span><span class="name">argc</span><span class="punctuation">,</span><span class="name">argv</span><span class="punctuation">);</span>
<span class="ln">20 </span>
<span class="ln">21 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">set_polling_threads_pool_size</span><span class="punctuation">(</span><span class="literal number integer">5</span><span class="punctuation">);</span>
<span class="ln">22 </span>
<span class="ln">23 </span>        <span class="comment single">// Create the device server singleton
</span><span class="ln">24 </span><span class="comment single"></span>        <span class="comment single">//        which will create everything
</span><span class="ln">25 </span><span class="comment single"></span>        <span class="comment single">//----------------------------------------
</span><span class="ln">26 </span><span class="comment single"></span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_init</span><span class="punctuation">(</span><span class="name builtin">false</span><span class="punctuation">);</span>
<span class="ln">27 </span>
<span class="ln">28 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_set_event_loop</span><span class="punctuation">(</span><span class="name">my_event_loop</span><span class="punctuation">);</span>
<span class="ln">29 </span>
<span class="ln">30 </span>        <span class="comment single">// Run the endless loop
</span><span class="ln">31 </span><span class="comment single"></span>        <span class="comment single">//----------------------------------------
</span><span class="ln">32 </span><span class="comment single"></span>        <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Ready to accept request&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">33 </span>        <span class="name">tg</span><span class="operator">-&gt;</span><span class="name">server_run</span><span class="punctuation">();</span>
<span class="ln">34 </span>     <span class="punctuation">}</span>
<span class="ln">35 </span>     <span class="keyword">catch</span> <span class="punctuation">(</span><span class="name">bad_alloc</span><span class="punctuation">)</span>
<span class="ln">36 </span>     <span class="punctuation">{</span>
<span class="ln">37 </span>     <span class="punctuation">...</span>
</pre>
<p>The device server main event loop is set at line 29 before the call to
the Util::server_run() method. The function used as server loop is
defined between lines 2 and 11.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="TangoDeviceServerModel.html" class="btn btn-neutral float-right" title="Tango Device Server Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="transferring-images.html" class="btn btn-neutral" title="Transferring images" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tango Community, Creative Commons Attribution 4.0 International (CC BY 4.0).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'9.2.5',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>