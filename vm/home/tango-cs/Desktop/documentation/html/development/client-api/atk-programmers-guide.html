

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TangoATK Programmer’s Guide &mdash; Tango Controls 9.2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Tango Controls 9.2.5 documentation" href="../../index.html"/>
        <link rel="up" title="Tango Client" href="index.html"/>
        <link rel="next" title="PyTango - a Python binding to Tango" href="../device-api/python/index.html"/>
        <link rel="prev" title="Writing a TANGO client using TANGO C++ APIs" href="cpp-client-programmers-guide.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../contents.html" class="icon icon-home"> Tango Controls
          

          
            
            <img src="../../_static/logo_tangocontrols_white.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                9.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Welcome to Tango Controls documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-guidelines/index.html">General guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../corba.html">10 things you should know about CORBA</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Tango Client</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cpp-client-programmers-guide.html">Writing a TANGO client using TANGO C++ APIs</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">TangoATK Programmer’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../device-api/python/index.html">PyTango - a Python binding to Tango</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../device-api/index.html">Device Servers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging-and-testing/index.html">Debugging and Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/index.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpp-api/index.html">Tango Core C++ Classes Reference Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tools-and-extensions/index.html">Tools and Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials-and-howtos/index.html">Tutorials and How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">Tango Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="index.html">Tango Client</a> &raquo;</li>
        
      <li>TangoATK Programmer’s Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/development/client-api/atk-programmers-guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tangoatk-programmers-guide">
<span id="atk-programmers-guide"></span><h1>TangoATK Programmer’s Guide<a class="headerlink" href="#tangoatk-programmers-guide" title="Permalink to this headline">¶</a></h1>
<p>This chapter is only a brief Tango ATK (Application ToolKit)
programmer’s guide. You can find a reference guide with a full
description of TangoATK classes and methods in the ATK JavaDoc
(<a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/atk_doc/index.html">Tango ATK reference on-line documentation</a>).</p>
<p>A tutorial document <a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/atk_tutorial/Tutorials.pdf">Tango ATK Tutorial</a> is also provided
and includes the detailed description of the ATK architecture and the
ATK components. In the <a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/atk_tutorial/Tutorials.pdf">ATK Tutorial</a> you
can find some code examples and also Flash Demos which explain how to
start using Tango ATK.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This document describes how to develop applications using the Tango
Application Toolkit, TangoATK for short. It will start with a brief
description of the main concepts behind the toolkit, and then continue
with more practical, real-life examples to explain key parts.</p>
<div class="section" id="assumptions">
<h3>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h3>
<p>The author assumes that the reader has a good knowledge of the Java
programming language, and a thorough understanding of object-oriented
programming. Also, it is expected that the reader is fluent in all
aspects regarding Tango devices, attributes, and commands.</p>
</div>
</div>
<div class="section" id="the-key-concepts-of-tangoatk">
<h2>The key concepts of TangoATK<a class="headerlink" href="#the-key-concepts-of-tangoatk" title="Permalink to this headline">¶</a></h2>
<p>TangoATK was developed with these goals in mind</p>
<ul class="simple">
<li>TangoATK should help minimize development time</li>
<li>TangoATK should help minimize bugs in applications</li>
<li>TangoATK should support applications that contain attributes and
commands from several different devices.</li>
<li>TangoATK should help avoid code duplication.</li>
</ul>
<p>Since most Tango-applications were foreseen to be displayed on some sort
of graphic terminal, TangoATK needed to provide support for some sort of
graphic building blocks. To enable this, and since the toolkit was to be
written in Java, we looked to Swing to figure out how to do this.</p>
<p>Swing is developed using a variant over a design-pattern the
Model-View-Controller (MVC) pattern called <em>model-delegate</em>, where the
view and the controller of the MVC-pattern are merged into one object.</p>
<div class="line-block">
<div class="line"><img alt="image09" src="../../_images/core-widget.png" /></div>
</div>
<p>This pattern made the choice of labor division quite easy: all
non-graphic parts of TangoATK reside in the packages beneath
<cite>fr.esrf.tangoatk.core</cite>, and anything remotely graphic are located
beneath <cite>fr.esrf.tangoatk.widge</cite>t. More on the content and
organization of this will follow.</p>
<p>The communication between the non-graphic and graphic objects are done
by having the graphic object registering itself as a listener to the
non-graphic object, and the non-graphic object emmiting events telling
the listeners that its state has changed.</p>
<div class="section" id="minimize-development-time">
<h3>Minimize development time<a class="headerlink" href="#minimize-development-time" title="Permalink to this headline">¶</a></h3>
<p>For TangoATK to help minimize the development time of graphic
applications, the toolkit has been developed along two lines of thought</p>
<ul class="simple">
<li>Things that are needed in most applications are included, eg
<code class="docutils literal"><span class="pre">Splash</span></code>, a splash window which gives a graphical way for the
application to show the progress of a long operation. The splash
window is moslty used in the startup phase of the application.</li>
<li>Building blocks provided by TangoATK should be easy to use and follow
certain patterns, eg every graphic widget has a <code class="docutils literal"><span class="pre">setModel</span></code> method
which is used to connect the widget with its non-graphic model.</li>
</ul>
<p>In addition to this, TangoATK provides a framework for error handling,
something that is often a time consuming task.</p>
</div>
<div class="section" id="minimize-bugs-in-applications">
<h3>Minimize bugs in applications<a class="headerlink" href="#minimize-bugs-in-applications" title="Permalink to this headline">¶</a></h3>
<p>Together with the Tango API, TangoATK takes care of most of the hard
things related to programming with Tango. Using TangoATK the developer
can focus on developing her application, not on understanding Tango.</p>
</div>
<div class="section" id="attributes-and-commands-from-different-devices">
<h3>Attributes and commands from different devices<a class="headerlink" href="#attributes-and-commands-from-different-devices" title="Permalink to this headline">¶</a></h3>
<p>To be able to create applications with attributes and commands from
different devices, it was decided that the central objects of TangoATK
were not to be the device, but rather the <em>attributes and the commands</em>.
This will certainly feel a bit awkward at first, but trust me, the
design holds.</p>
<p>For this design to be feasible, a structure was needed to keep track of
the commands and attributes, so the <em>command-list and the
attribute-list</em> was introduced. These two objects can hold commands and
attributes from any number of devices.</p>
</div>
<div class="section" id="avoid-code-duplication">
<h3>Avoid code duplication<a class="headerlink" href="#avoid-code-duplication" title="Permalink to this headline">¶</a></h3>
<p>When writing applications for a control-system without a framework much
code is duplicated. Anything from simple widgets for showing numeric
values to error handling has to be implemented each time. TangoATK
supplies a number of frequently used widgets along with a framework for
connecting these widgets with their non-graphic counterparts. Because of
this, the developer only needs to write the <em>glue</em> - the code which
connects these objects in a manner that suits the specified application.</p>
</div>
</div>
<div class="section" id="the-real-getting-started">
<h2>The real getting started<a class="headerlink" href="#the-real-getting-started" title="Permalink to this headline">¶</a></h2>
<p>Generally there are two kinds of end-user applications: Applications
that only know how to treat one device, and applications that treat many
devices.</p>
<div class="section" id="single-device-applications">
<h3>Single device applications<a class="headerlink" href="#single-device-applications" title="Permalink to this headline">¶</a></h3>
<p>Single device applications are quite easy to write, even with a gui. The
following steps are required</p>
<ol class="arabic simple">
<li>Instantiate an AttributeList and fill it with the attributes you
want.</li>
<li>Instantiate a CommandList and fill it with the commands you want.</li>
<li>Connect the whole <cite>AttributeList</cite> with a <cite>list viewer</cite> and / or each
<em>individual attribute</em> with an <em>attribute viewer</em>.</li>
<li>Connect the whole <cite>CommandList</cite> to a <em>command list viewer</em> and / or
connect each <em>individual command</em> in the command list with a <em>command
viewer</em>.</li>
</ol>
<p><img alt="image10" src="../../_images/listpanel.png" /></p>
<p>The following program (FirstApplication) shows an implementation of the
list mentioned above. It should be rather self-explanatory with the
comments.</p>
<pre class="code java literal-block">
<span class="ln">  1 </span> <span class="keyword namespace">package</span> <span class="name namespace">examples</span><span class="operator">;</span>
<span class="ln">  2 </span>
<span class="ln">  3 </span>
<span class="ln">  4 </span> <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JFrame</span><span class="operator">;</span>
<span class="ln">  5 </span> <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenuItem</span><span class="operator">;</span>
<span class="ln">  6 </span> <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenuBar</span><span class="operator">;</span>
<span class="ln">  7 </span> <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenu</span><span class="operator">;</span>
<span class="ln">  8 </span>
<span class="ln">  9 </span>
<span class="ln"> 10 </span> <span class="keyword namespace">import</span> <span class="name namespace">java.awt.event.ActionListener</span><span class="operator">;</span>
<span class="ln"> 11 </span> <span class="keyword namespace">import</span> <span class="name namespace">java.awt.event.ActionEvent</span><span class="operator">;</span>
<span class="ln"> 12 </span> <span class="keyword namespace">import</span> <span class="name namespace">java.awt.BorderLayout</span><span class="operator">;</span>
<span class="ln"> 13 </span>
<span class="ln"> 14 </span>
<span class="ln"> 15 </span> <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.AttributeList</span><span class="operator">;</span>
<span class="ln"> 16 </span> <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.ConnectionException</span><span class="operator">;</span>
<span class="ln"> 17 </span>
<span class="ln"> 18 </span>
<span class="ln"> 19 </span> <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.CommandList</span><span class="operator">;</span>
<span class="ln"> 20 </span> <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.util.ErrorHistory</span><span class="operator">;</span>
<span class="ln"> 21 </span> <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.util.ATKGraphicsUtils</span><span class="operator">;</span>
<span class="ln"> 22 </span> <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.attribute.ScalarListViewer</span><span class="operator">;</span>
<span class="ln"> 23 </span> <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.command.CommandComboViewer</span><span class="operator">;</span>
<span class="ln"> 24 </span>
<span class="ln"> 25 </span>
<span class="ln"> 26 </span> <span class="keyword declaration">public</span> <span class="keyword declaration">class</span> <span class="name class">FirstApplication</span> <span class="keyword declaration">extends</span> <span class="name">JFrame</span>
<span class="ln"> 27 </span> <span class="operator">{</span>
<span class="ln"> 28 </span> <span class="name">JMenuBar</span> <span class="name">menu</span><span class="operator">;</span>                    <span class="comment single">// So that our application looks
</span><span class="ln"> 29 </span><span class="comment single"></span>                                   <span class="comment single">// halfway decent.
</span><span class="ln"> 30 </span><span class="comment single"></span> <span class="name">AttributeList</span> <span class="name">attributes</span><span class="operator">;</span>         <span class="comment single">// The list that will contain our
</span><span class="ln"> 31 </span><span class="comment single"></span>                                   <span class="comment single">// attributes
</span><span class="ln"> 32 </span><span class="comment single"></span> <span class="name">CommandList</span> <span class="name">commands</span><span class="operator">;</span>             <span class="comment single">// The list that will contain our
</span><span class="ln"> 33 </span><span class="comment single"></span>                                   <span class="comment single">// commands
</span><span class="ln"> 34 </span><span class="comment single"></span> <span class="name">ErrorHistory</span> <span class="name">errorHistory</span><span class="operator">;</span>        <span class="comment single">// A window that displays errors
</span><span class="ln"> 35 </span><span class="comment single"></span> <span class="name">ScalarListViewer</span> <span class="name">sListViewer</span><span class="operator">;</span>     <span class="comment single">// A viewer which knows how to
</span><span class="ln"> 36 </span><span class="comment single"></span>                                   <span class="comment single">// display a list of scalar attributes.
</span><span class="ln"> 37 </span><span class="comment single"></span>                                   <span class="comment single">// If you want to display other types
</span><span class="ln"> 38 </span><span class="comment single"></span>                                   <span class="comment single">// than scalars, you'll have to wait
</span><span class="ln"> 39 </span><span class="comment single"></span>                                   <span class="comment single">// for the next example.
</span><span class="ln"> 40 </span><span class="comment single"></span> <span class="name">CommandComboViewer</span> <span class="name">commandViewer</span><span class="operator">;</span> <span class="comment single">// A viewer which knows how to display
</span><span class="ln"> 41 </span><span class="comment single"></span>                                   <span class="comment single">// a combobox of commands and execute
</span><span class="ln"> 42 </span><span class="comment single"></span>                                   <span class="comment single">// them.
</span><span class="ln"> 43 </span><span class="comment single"></span> <span class="name">String</span> <span class="name">device</span><span class="operator">;</span>                    <span class="comment single">// The name of our device.
</span><span class="ln"> 44 </span><span class="comment single"></span>
<span class="ln"> 45 </span>
<span class="ln"> 46 </span> <span class="keyword declaration">public</span> <span class="name function">FirstApplication</span><span class="operator">()</span>
<span class="ln"> 47 </span> <span class="operator">{</span>
<span class="ln"> 48 </span>    <span class="comment single">// The swing stuff to create the menu bar and its pulldown menus
</span><span class="ln"> 49 </span><span class="comment single"></span>    <span class="name">menu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuBar</span><span class="operator">();</span>
<span class="ln"> 50 </span>    <span class="name">JMenu</span> <span class="name">fileMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="operator">();</span>
<span class="ln"> 51 </span>    <span class="name">fileMenu</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;File&quot;</span><span class="operator">);</span>
<span class="ln"> 52 </span>    <span class="name">JMenu</span> <span class="name">viewMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="operator">();</span>
<span class="ln"> 53 </span>    <span class="name">viewMenu</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;View&quot;</span><span class="operator">);</span>
<span class="ln"> 54 </span>
<span class="ln"> 55 </span>    <span class="name">JMenuItem</span> <span class="name">quitItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="operator">();</span>
<span class="ln"> 56 </span>    <span class="name">quitItem</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;Quit&quot;</span><span class="operator">);</span>
<span class="ln"> 57 </span>    <span class="name">quitItem</span><span class="operator">.</span><span class="name attribute">addActionListener</span><span class="operator">(</span><span class="keyword">new</span>
<span class="ln"> 58 </span>       <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">event</span><span class="operator">.</span><span class="name attribute">ActionListener</span><span class="operator">()</span>
<span class="ln"> 59 </span>       <span class="operator">{</span>
<span class="ln"> 60 </span>        <span class="keyword declaration">public</span> <span class="keyword type">void</span>
<span class="ln"> 61 </span>        <span class="name function">actionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln"> 62 </span>        <span class="operator">{</span><span class="name">quitItemActionPerformed</span><span class="operator">(</span><span class="name">evt</span><span class="operator">);}</span>
<span class="ln"> 63 </span>       <span class="operator">});</span>
<span class="ln"> 64 </span>    <span class="name">fileMenu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">quitItem</span><span class="operator">);</span>
<span class="ln"> 65 </span>
<span class="ln"> 66 </span>    <span class="name">JMenuItem</span> <span class="name">errorHistItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="operator">();</span>
<span class="ln"> 67 </span>    <span class="name">errorHistItem</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;Error History&quot;</span><span class="operator">);</span>
<span class="ln"> 68 </span>    <span class="name">errorHistItem</span><span class="operator">.</span><span class="name attribute">addActionListener</span><span class="operator">(</span><span class="keyword">new</span>
<span class="ln"> 69 </span>            <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">event</span><span class="operator">.</span><span class="name attribute">ActionListener</span><span class="operator">()</span>
<span class="ln"> 70 </span>            <span class="operator">{</span>
<span class="ln"> 71 </span>             <span class="keyword declaration">public</span> <span class="keyword type">void</span>
<span class="ln"> 72 </span>             <span class="name function">actionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln"> 73 </span>             <span class="operator">{</span><span class="name">errHistItemActionPerformed</span><span class="operator">(</span><span class="name">evt</span><span class="operator">);}</span>
<span class="ln"> 74 </span>            <span class="operator">});</span>
<span class="ln"> 75 </span>    <span class="name">viewMenu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">errorHistItem</span><span class="operator">);</span>
<span class="ln"> 76 </span>    <span class="name">menu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">fileMenu</span><span class="operator">);</span>
<span class="ln"> 77 </span>    <span class="name">menu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">viewMenu</span><span class="operator">);</span>
<span class="ln"> 78 </span>
<span class="ln"> 79 </span>    <span class="comment single">//
</span><span class="ln"> 80 </span><span class="comment single"></span>    <span class="comment single">// Here we create ATK objects to handle attributes, commands and errors.
</span><span class="ln"> 81 </span><span class="comment single"></span>    <span class="comment single">//
</span><span class="ln"> 82 </span><span class="comment single"></span>    <span class="name">attributes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">AttributeList</span><span class="operator">();</span>
<span class="ln"> 83 </span>    <span class="name">commands</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">CommandList</span><span class="operator">();</span>
<span class="ln"> 84 </span>    <span class="name">errorHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ErrorHistory</span><span class="operator">();</span>
<span class="ln"> 85 </span>    <span class="name">device</span> <span class="operator">=</span> <span class="literal string">&quot;id14/eh3_mirror/1&quot;</span><span class="operator">;</span>
<span class="ln"> 86 </span>    <span class="name">sListViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ScalarListViewer</span><span class="operator">();</span>
<span class="ln"> 87 </span>    <span class="name">commandViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">CommandComboViewer</span><span class="operator">();</span>
<span class="ln"> 88 </span>
<span class="ln"> 89 </span>
<span class="ln"> 90 </span> <span class="comment single">//
</span><span class="ln"> 91 </span><span class="comment single"></span> <span class="comment single">// A feature of the command and attribute list is that if you
</span><span class="ln"> 92 </span><span class="comment single"></span> <span class="comment single">// supply an errorlistener to these lists, they'll add that
</span><span class="ln"> 93 </span><span class="comment single"></span> <span class="comment single">// errorlistener to all subsequently created attributes or
</span><span class="ln"> 94 </span><span class="comment single"></span> <span class="comment single">// commands. So it is important to do this _before_ you
</span><span class="ln"> 95 </span><span class="comment single"></span> <span class="comment single">// start adding attributes or commands.
</span><span class="ln"> 96 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln"> 97 </span><span class="comment single"></span>
<span class="ln"> 98 </span>    <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">addErrorListener</span><span class="operator">(</span><span class="name">errorHistory</span><span class="operator">);</span>
<span class="ln"> 99 </span>    <span class="name">commands</span><span class="operator">.</span><span class="name attribute">addErrorListener</span><span class="operator">(</span><span class="name">errorHistory</span><span class="operator">);</span>
<span class="ln">100 </span>
<span class="ln">101 </span> <span class="comment single">//
</span><span class="ln">102 </span><span class="comment single"></span> <span class="comment single">// Sometimes we're out of luck and the device or the attributes
</span><span class="ln">103 </span><span class="comment single"></span> <span class="comment single">// are not available. In that case a ConnectionException is thrown.
</span><span class="ln">104 </span><span class="comment single"></span> <span class="comment single">// This is why we add the attributes in a try/catch
</span><span class="ln">105 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">106 </span><span class="comment single"></span>
<span class="ln">107 </span>    <span class="keyword">try</span>
<span class="ln">108 </span>    <span class="operator">{</span>
<span class="ln">109 </span>
<span class="ln">110 </span> <span class="comment single">//
</span><span class="ln">111 </span><span class="comment single"></span> <span class="comment single">// Another feature of the attribute and command list is that they
</span><span class="ln">112 </span><span class="comment single"></span> <span class="comment single">// can add wildcard names, currently only `*' is supported.
</span><span class="ln">113 </span><span class="comment single"></span> <span class="comment single">// When using a wildcard, the lists will add all commands or
</span><span class="ln">114 </span><span class="comment single"></span> <span class="comment single">// attributes available on the device.
</span><span class="ln">115 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">116 </span><span class="comment single"></span>    <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot;/*&quot;</span><span class="operator">);</span>
<span class="ln">117 </span>    <span class="operator">}</span>
<span class="ln">118 </span>    <span class="keyword">catch</span> <span class="operator">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="operator">)</span>
<span class="ln">119 </span>    <span class="operator">{</span>
<span class="ln">120 </span>       <span class="name">System</span><span class="operator">.</span><span class="name attribute">out</span><span class="operator">.</span><span class="name attribute">println</span><span class="operator">(</span><span class="literal string">&quot;Error fetching &quot;</span> <span class="operator">+</span>
<span class="ln">121 </span>                          <span class="literal string">&quot;attributes from &quot;</span> <span class="operator">+</span>
<span class="ln">122 </span>                          <span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="operator">);</span>
<span class="ln">123 </span>    <span class="operator">}</span>
<span class="ln">124 </span>
<span class="ln">125 </span>
<span class="ln">126 </span> <span class="comment single">//
</span><span class="ln">127 </span><span class="comment single"></span> <span class="comment single">// See the comments for attributelist
</span><span class="ln">128 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">129 </span><span class="comment single"></span>
<span class="ln">130 </span>
<span class="ln">131 </span>    <span class="keyword">try</span>
<span class="ln">132 </span>    <span class="operator">{</span>
<span class="ln">133 </span>       <span class="name">commands</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot;/*&quot;</span><span class="operator">);</span>
<span class="ln">134 </span>    <span class="operator">}</span>
<span class="ln">135 </span>    <span class="keyword">catch</span> <span class="operator">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="operator">)</span>
<span class="ln">136 </span>    <span class="operator">{</span>
<span class="ln">137 </span>       <span class="name">System</span><span class="operator">.</span><span class="name attribute">out</span><span class="operator">.</span><span class="name attribute">println</span><span class="operator">(</span><span class="literal string">&quot;Error fetching &quot;</span> <span class="operator">+</span>
<span class="ln">138 </span>                          <span class="literal string">&quot;commands from &quot;</span> <span class="operator">+</span>
<span class="ln">139 </span>                          <span class="name">device</span> <span class="operator">+</span> <span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="operator">);</span>
<span class="ln">140 </span>    <span class="operator">}</span>
<span class="ln">141 </span>
<span class="ln">142 </span>
<span class="ln">143 </span> <span class="comment single">//
</span><span class="ln">144 </span><span class="comment single"></span> <span class="comment single">// Here we tell the scalarViewer what it's to show. The
</span><span class="ln">145 </span><span class="comment single"></span> <span class="comment single">// ScalarListViewer loops through the attribute-list and picks out
</span><span class="ln">146 </span><span class="comment single"></span> <span class="comment single">// the ones which are scalars and show them.
</span><span class="ln">147 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">148 </span><span class="comment single"></span>
<span class="ln">149 </span>    <span class="name">sListViewer</span><span class="operator">.</span><span class="name attribute">setModel</span><span class="operator">(</span><span class="name">attributes</span><span class="operator">);</span>
<span class="ln">150 </span>
<span class="ln">151 </span>
<span class="ln">152 </span> <span class="comment single">//
</span><span class="ln">153 </span><span class="comment single"></span> <span class="comment single">// This is where the CommandComboViewer is told what it's to
</span><span class="ln">154 </span><span class="comment single"></span> <span class="comment single">// show. It knows how to show and execute most commands.
</span><span class="ln">155 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">156 </span><span class="comment single"></span>
<span class="ln">157 </span>
<span class="ln">158 </span>    <span class="name">commandViewer</span><span class="operator">.</span><span class="name attribute">setModel</span><span class="operator">(</span><span class="name">commands</span><span class="operator">);</span>
<span class="ln">159 </span>
<span class="ln">160 </span>
<span class="ln">161 </span> <span class="comment single">//
</span><span class="ln">162 </span><span class="comment single"></span> <span class="comment single">// add the menubar to the frame
</span><span class="ln">163 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">164 </span><span class="comment single"></span>
<span class="ln">165 </span>
<span class="ln">166 </span>    <span class="name">setJMenuBar</span><span class="operator">(</span><span class="name">menu</span><span class="operator">);</span>
<span class="ln">167 </span>
<span class="ln">168 </span>
<span class="ln">169 </span> <span class="comment single">//
</span><span class="ln">170 </span><span class="comment single"></span> <span class="comment single">// Make the layout nice.
</span><span class="ln">171 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">172 </span><span class="comment single"></span>
<span class="ln">173 </span>
<span class="ln">174 </span>    <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">setLayout</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">BorderLayout</span><span class="operator">());</span>
<span class="ln">175 </span>    <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">commandViewer</span><span class="operator">,</span> <span class="name">BorderLayout</span><span class="operator">.</span><span class="name attribute">NORTH</span><span class="operator">);</span>
<span class="ln">176 </span>    <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">sListViewer</span><span class="operator">,</span> <span class="name">BorderLayout</span><span class="operator">.</span><span class="name attribute">SOUTH</span><span class="operator">);</span>
<span class="ln">177 </span>
<span class="ln">178 </span>
<span class="ln">179 </span> <span class="comment single">//
</span><span class="ln">180 </span><span class="comment single"></span> <span class="comment single">// A third feature of the attributelist is that it knows how
</span><span class="ln">181 </span><span class="comment single"></span> <span class="comment single">// to refresh its attributes.
</span><span class="ln">182 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">183 </span><span class="comment single"></span>
<span class="ln">184 </span>
<span class="ln">185 </span>    <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">startRefresher</span><span class="operator">();</span>
<span class="ln">186 </span>
<span class="ln">187 </span>
<span class="ln">188 </span> <span class="comment single">//
</span><span class="ln">189 </span><span class="comment single"></span> <span class="comment single">// JFrame stuff to make the thing show.
</span><span class="ln">190 </span><span class="comment single"></span> <span class="comment single">//
</span><span class="ln">191 </span><span class="comment single"></span>
<span class="ln">192 </span>
<span class="ln">193 </span>    <span class="name">pack</span><span class="operator">();</span>
<span class="ln">194 </span>    <span class="name">ATKGraphicsUtils</span><span class="operator">.</span><span class="name attribute">centerFrameOnScreen</span><span class="operator">(</span><span class="keyword">this</span><span class="operator">);</span> <span class="comment single">//ATK utility to center window
</span><span class="ln">195 </span><span class="comment single"></span>
<span class="ln">196 </span>    <span class="name">setVisible</span><span class="operator">(</span><span class="keyword constant">true</span><span class="operator">);</span>
<span class="ln">197 </span>    <span class="operator">}</span>
<span class="ln">198 </span>
<span class="ln">199 </span>
<span class="ln">200 </span>    <span class="keyword declaration">public</span> <span class="keyword declaration">static</span> <span class="keyword type">void</span> <span class="name function">main</span><span class="operator">(</span><span class="name">String</span> <span class="operator">[]</span> <span class="name">args</span><span class="operator">)</span>
<span class="ln">201 </span>    <span class="operator">{</span>
<span class="ln">202 </span>       <span class="keyword">new</span> <span class="name">FirstApplication</span><span class="operator">();</span>
<span class="ln">203 </span>    <span class="operator">}</span>
<span class="ln">204 </span>
<span class="ln">205 </span>    <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">quitItemActionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln">206 </span>    <span class="operator">{</span>
<span class="ln">207 </span>       <span class="name">System</span><span class="operator">.</span><span class="name attribute">exit</span><span class="operator">(</span><span class="literal number integer">0</span><span class="operator">);</span>
<span class="ln">208 </span>    <span class="operator">}</span>
<span class="ln">209 </span>
<span class="ln">210 </span>    <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">errHistItemActionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln">211 </span>    <span class="operator">{</span>
<span class="ln">212 </span>       <span class="name">errorHistory</span><span class="operator">.</span><span class="name attribute">setVisible</span><span class="operator">(</span><span class="keyword constant">true</span><span class="operator">);</span>
<span class="ln">213 </span>    <span class="operator">}</span>
<span class="ln">214 </span> <span class="operator">}</span>
</pre>
<p>The program should look something like this (depending on your platform
and your device)</p>
<p><img alt="image11" src="../../_images/prog_guide_exple1.jpg" /></p>
</div>
<div class="section" id="multi-device-applications">
<h3>Multi device applications<a class="headerlink" href="#multi-device-applications" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Multi device applications are quite similar to the single device
applications, the only difference is that it does not suffice to add
the attributes by wildcard, you need to add them explicitly, like
this:</div>
</div>
<pre class="code java literal-block">
<span class="ln"> 1 </span>  <span class="keyword">try</span>
<span class="ln"> 2 </span>  <span class="operator">{</span>
<span class="ln"> 3 </span>      <span class="comment single">// a StringScalar attribute from the device one
</span><span class="ln"> 4 </span><span class="comment single"></span>     <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="literal string">&quot;jlp/test/1/att_cinq&quot;</span><span class="operator">);</span>
<span class="ln"> 5 </span>     <span class="comment single">// a NumberSpectrum attribute from the device one
</span><span class="ln"> 6 </span><span class="comment single"></span>     <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="literal string">&quot;jlp/test/1/att_spectrum&quot;</span><span class="operator">);</span>
<span class="ln"> 7 </span>     <span class="comment single">// a NumberImage attribute from the device two
</span><span class="ln"> 8 </span><span class="comment single"></span>     <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="literal string">&quot;sr/d-ipc/id25-1n/Image&quot;</span><span class="operator">);</span>
<span class="ln"> 9 </span>  <span class="operator">}</span>
<span class="ln">10 </span>  <span class="keyword">catch</span> <span class="operator">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="operator">)</span>
<span class="ln">11 </span>  <span class="operator">{</span>
<span class="ln">12 </span>     <span class="name">System</span><span class="operator">.</span><span class="name attribute">out</span><span class="operator">.</span><span class="name attribute">println</span><span class="operator">(</span><span class="literal string">&quot;Error fetching &quot;</span> <span class="operator">+</span>
<span class="ln">13 </span>         <span class="literal string">&quot;attributes&quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="operator">);</span>
<span class="ln">14 </span>  <span class="operator">}</span>
</pre>
<p>The same goes for commands.</p>
</div>
<div class="section" id="more-on-displaying-attributes">
<h3>More on displaying attributes<a class="headerlink" href="#more-on-displaying-attributes" title="Permalink to this headline">¶</a></h3>
<p>So far, we’ve only considered scalar attributes, and not only that,
we’ve also cheated quite a bit since we just passed the attribute list
to the <code class="docutils literal"><span class="pre">fr.esrf.tangoatk.widget.attribute.ScalarListViewer</span></code> and let it
do all the magic. The attribute list viewers are only available for
scalar attributes (NumberScalarListViewer and ScalarListViewer). If you
have one or several spectrum or image attributes you must connect each
spectrum or image attribute to it’s corresponding attribute viewer
individually. So let’s take a look at how you can connect individual
attributes (and not a whole attribute list) to an individual attribute
viewer (and not to an attribute list viewer).</p>
<div class="section" id="connecting-an-attribute-to-a-viewer">
<h4>Connecting an attribute to a viewer<a class="headerlink" href="#connecting-an-attribute-to-a-viewer" title="Permalink to this headline">¶</a></h4>
<p>Generally it is done in the following way:</p>
<ol class="arabic simple">
<li>You retrieve the attribute from the attribute list</li>
<li>You instantiate the viewer</li>
<li>Your call the <code class="docutils literal"><span class="pre">setModel</span></code> method on the viewer with the attribute as
argument.</li>
<li>You add your viewer to some panel</li>
</ol>
<p>The following example (SecondApplication), is a Multi-device
application. Since this application uses individual attribute viewers
and not an attribute list viewer, it shows an implementation of the list
mentioned above.</p>
<pre class="code java literal-block">
<span class="ln">  1 </span>  <span class="keyword namespace">package</span> <span class="name namespace">examples</span><span class="operator">;</span>
<span class="ln">  2 </span>
<span class="ln">  3 </span>
<span class="ln">  4 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JFrame</span><span class="operator">;</span>
<span class="ln">  5 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenuItem</span><span class="operator">;</span>
<span class="ln">  6 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenuBar</span><span class="operator">;</span>
<span class="ln">  7 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenu</span><span class="operator">;</span>
<span class="ln">  8 </span>
<span class="ln">  9 </span>
<span class="ln"> 10 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.awt.event.ActionListener</span><span class="operator">;</span>
<span class="ln"> 11 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.awt.event.ActionEvent</span><span class="operator">;</span>
<span class="ln"> 12 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.awt.BorderLayout</span><span class="operator">;</span>
<span class="ln"> 13 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.awt.Color</span><span class="operator">;</span>
<span class="ln"> 14 </span>
<span class="ln"> 15 </span>
<span class="ln"> 16 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.AttributeList</span><span class="operator">;</span>
<span class="ln"> 17 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.ConnectionException</span><span class="operator">;</span>
<span class="ln"> 18 </span>
<span class="ln"> 19 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.IStringScalar</span><span class="operator">;</span>
<span class="ln"> 20 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.INumberSpectrum</span><span class="operator">;</span>
<span class="ln"> 21 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.core.INumberImage</span><span class="operator">;</span>
<span class="ln"> 22 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.util.ErrorHistory</span><span class="operator">;</span>
<span class="ln"> 23 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.util.Gradient</span><span class="operator">;</span>
<span class="ln"> 24 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.util.ATKGraphicsUtils</span><span class="operator">;</span>
<span class="ln"> 25 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.attribute.NumberImageViewer</span><span class="operator">;</span>
<span class="ln"> 26 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.attribute.NumberSpectrumViewer</span><span class="operator">;</span>
<span class="ln"> 27 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.attribute.SimpleScalarViewer</span><span class="operator">;</span>
<span class="ln"> 28 </span>
<span class="ln"> 29 </span>  <span class="keyword declaration">public</span> <span class="keyword declaration">class</span> <span class="name class">SecondApplication</span> <span class="keyword declaration">extends</span> <span class="name">JFrame</span>
<span class="ln"> 30 </span>  <span class="operator">{</span>
<span class="ln"> 31 </span>       <span class="name">JMenuBar</span>            <span class="name">menu</span><span class="operator">;</span>
<span class="ln"> 32 </span>       <span class="name">AttributeList</span>       <span class="name">attributes</span><span class="operator">;</span>   <span class="comment single">// The list that will contain our attributes
</span><span class="ln"> 33 </span><span class="comment single"></span>       <span class="name">ErrorHistory</span>        <span class="name">errorHistory</span><span class="operator">;</span> <span class="comment single">// A window that displays errors
</span><span class="ln"> 34 </span><span class="comment single"></span>       <span class="name">IStringScalar</span>        <span class="name">ssAtt</span><span class="operator">;</span>
<span class="ln"> 35 </span>       <span class="name">INumberSpectrum</span>      <span class="name">nsAtt</span><span class="operator">;</span>
<span class="ln"> 36 </span>       <span class="name">INumberImage</span>         <span class="name">niAtt</span><span class="operator">;</span>
<span class="ln"> 37 </span>       <span class="keyword declaration">public</span> <span class="name function">SecondApplication</span><span class="operator">()</span>
<span class="ln"> 38 </span>       <span class="operator">{</span>
<span class="ln"> 39 </span>          <span class="comment single">// Swing stuff to create the menu bar and its pulldown menus
</span><span class="ln"> 40 </span><span class="comment single"></span>          <span class="name">menu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuBar</span><span class="operator">();</span>
<span class="ln"> 41 </span>          <span class="name">JMenu</span> <span class="name">fileMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="operator">();</span>
<span class="ln"> 42 </span>          <span class="name">fileMenu</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;File&quot;</span><span class="operator">);</span>
<span class="ln"> 43 </span>          <span class="name">JMenu</span> <span class="name">viewMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="operator">();</span>
<span class="ln"> 44 </span>          <span class="name">viewMenu</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;View&quot;</span><span class="operator">);</span>
<span class="ln"> 45 </span>          <span class="name">JMenuItem</span> <span class="name">quitItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="operator">();</span>
<span class="ln"> 46 </span>          <span class="name">quitItem</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;Quit&quot;</span><span class="operator">);</span>
<span class="ln"> 47 </span>          <span class="name">quitItem</span><span class="operator">.</span><span class="name attribute">addActionListener</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">event</span><span class="operator">.</span><span class="name attribute">ActionListener</span><span class="operator">()</span>
<span class="ln"> 48 </span>                                        <span class="operator">{</span>
<span class="ln"> 49 </span>                                         <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">actionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln"> 50 </span>                                         <span class="operator">{</span><span class="name">quitItemActionPerformed</span><span class="operator">(</span><span class="name">evt</span><span class="operator">);}</span>
<span class="ln"> 51 </span>                                        <span class="operator">});</span>
<span class="ln"> 52 </span>
<span class="ln"> 53 </span>          <span class="name">fileMenu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">quitItem</span><span class="operator">);</span>
<span class="ln"> 54 </span>          <span class="name">JMenuItem</span> <span class="name">errorHistItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="operator">();</span>
<span class="ln"> 55 </span>          <span class="name">errorHistItem</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;Error History&quot;</span><span class="operator">);</span>
<span class="ln"> 56 </span>          <span class="name">errorHistItem</span><span class="operator">.</span><span class="name attribute">addActionListener</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">event</span><span class="operator">.</span><span class="name attribute">ActionListener</span><span class="operator">()</span>
<span class="ln"> 57 </span>                  <span class="operator">{</span>
<span class="ln"> 58 </span>                   <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">actionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln"> 59 </span>                   <span class="operator">{</span><span class="name">errHistItemActionPerformed</span><span class="operator">(</span><span class="name">evt</span><span class="operator">);}</span>
<span class="ln"> 60 </span>                  <span class="operator">});</span>
<span class="ln"> 61 </span>          <span class="name">viewMenu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">errorHistItem</span><span class="operator">);</span>
<span class="ln"> 62 </span>          <span class="name">menu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">fileMenu</span><span class="operator">);</span>
<span class="ln"> 63 </span>          <span class="name">menu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">viewMenu</span><span class="operator">);</span>
<span class="ln"> 64 </span>        <span class="comment single">//
</span><span class="ln"> 65 </span><span class="comment single"></span>        <span class="comment single">// Here we create TangoATK objects to view attributes and errors.
</span><span class="ln"> 66 </span><span class="comment single"></span>        <span class="comment single">//
</span><span class="ln"> 67 </span><span class="comment single"></span>          <span class="name">attributes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">AttributeList</span><span class="operator">();</span>
<span class="ln"> 68 </span>          <span class="name">errorHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ErrorHistory</span><span class="operator">();</span>
<span class="ln"> 69 </span>        <span class="comment single">//
</span><span class="ln"> 70 </span><span class="comment single"></span>        <span class="comment single">// We create a SimpleScalarViewer, a NumberSpectrumViewer and
</span><span class="ln"> 71 </span><span class="comment single"></span>        <span class="comment single">// a NumberImageViewer, since we already knew that we were
</span><span class="ln"> 72 </span><span class="comment single"></span>        <span class="comment single">// playing with a scalar attribute, a number spectrum attribute
</span><span class="ln"> 73 </span><span class="comment single"></span>        <span class="comment single">// and a number image attribute this time.
</span><span class="ln"> 74 </span><span class="comment single"></span>        <span class="comment single">//
</span><span class="ln"> 75 </span><span class="comment single"></span>        <span class="name">SimpleScalarViewer</span>     <span class="name">ssViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">SimpleScalarViewer</span><span class="operator">();</span>
<span class="ln"> 76 </span>          <span class="name">NumberSpectrumViewer</span>   <span class="name">nSpectViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">NumberSpectrumViewer</span><span class="operator">();</span>
<span class="ln"> 77 </span>          <span class="name">NumberImageViewer</span>      <span class="name">nImageViewer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">NumberImageViewer</span><span class="operator">();</span>
<span class="ln"> 78 </span>          <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">addErrorListener</span><span class="operator">(</span><span class="name">errorHistory</span><span class="operator">);</span>
<span class="ln"> 79 </span>       <span class="comment single">//
</span><span class="ln"> 80 </span><span class="comment single"></span>       <span class="comment single">// The attribute (and command) list has the feature of returning the last
</span><span class="ln"> 81 </span><span class="comment single"></span>       <span class="comment single">// attribute that was added to it. Just remember that it is returned as an
</span><span class="ln"> 82 </span><span class="comment single"></span>       <span class="comment single">// IEntity object, so you need to cast it into a more specific object, like
</span><span class="ln"> 83 </span><span class="comment single"></span>       <span class="comment single">// IStringScalar, which is the interface which defines a string scalar
</span><span class="ln"> 84 </span><span class="comment single"></span>       <span class="comment single">//
</span><span class="ln"> 85 </span><span class="comment single"></span>         <span class="keyword">try</span>
<span class="ln"> 86 </span>          <span class="operator">{</span>
<span class="ln"> 87 </span>
<span class="ln"> 88 </span>             <span class="name">ssAtt</span> <span class="operator">=</span> <span class="operator">(</span><span class="name">IStringScalar</span><span class="operator">)</span> <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="literal string">&quot;jlp/test/1/att_cinq&quot;</span><span class="operator">);</span>
<span class="ln"> 89 </span>             <span class="name">nsAtt</span> <span class="operator">=</span> <span class="operator">(</span><span class="name">INumberSpectrum</span><span class="operator">)</span> <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="literal string">&quot;jlp/test/1/att_spectrum&quot;</span><span class="operator">);</span>
<span class="ln"> 90 </span>             <span class="name">niAtt</span> <span class="operator">=</span> <span class="operator">(</span><span class="name">INumberImage</span><span class="operator">)</span> <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="literal string">&quot;sr/d-ipc/id25-1n/Image&quot;</span><span class="operator">);</span>
<span class="ln"> 91 </span>          <span class="operator">}</span>
<span class="ln"> 92 </span>          <span class="keyword">catch</span> <span class="operator">(</span><span class="name">ConnectionException</span> <span class="name">ce</span><span class="operator">)</span>
<span class="ln"> 93 </span>          <span class="operator">{</span>
<span class="ln"> 94 </span>             <span class="name">System</span><span class="operator">.</span><span class="name attribute">out</span><span class="operator">.</span><span class="name attribute">println</span><span class="operator">(</span><span class="literal string">&quot;Error fetching one of the attributes  &quot;</span><span class="operator">+</span><span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">ce</span><span class="operator">);</span>
<span class="ln"> 95 </span>             <span class="name">System</span><span class="operator">.</span><span class="name attribute">out</span><span class="operator">.</span><span class="name attribute">println</span><span class="operator">(</span><span class="literal string">&quot;Application Aborted.&quot;</span><span class="operator">);</span>
<span class="ln"> 96 </span>             <span class="name">System</span><span class="operator">.</span><span class="name attribute">exit</span><span class="operator">(</span><span class="literal number integer">0</span><span class="operator">);</span>
<span class="ln"> 97 </span>          <span class="operator">}</span>
<span class="ln"> 98 </span>          <span class="comment single">//
</span><span class="ln"> 99 </span><span class="comment single"></span>          <span class="comment single">// Pay close attention to the following three lines!! This is how it's done!
</span><span class="ln">100 </span><span class="comment single"></span>          <span class="comment single">// This is how it's always done! The setModelsetModel method of any viewer takes care
</span><span class="ln">101 </span><span class="comment single"></span>         <span class="comment single">// of connecting the viewer to the attribute (model) it's in charge of displaying.
</span><span class="ln">102 </span><span class="comment single"></span>         <span class="comment single">// This is the way to tell each viewer what (which attribute) it has to show.
</span><span class="ln">103 </span><span class="comment single"></span>         <span class="comment single">// Note that we use a viewer adapted to each type of attribute
</span><span class="ln">104 </span><span class="comment single"></span>         <span class="comment single">//
</span><span class="ln">105 </span><span class="comment single"></span>          <span class="name">ssViewer</span><span class="operator">.</span><span class="name attribute">setModel</span><span class="operator">(</span><span class="name">ssAtt</span><span class="operator">);</span>
<span class="ln">106 </span>          <span class="name">nSpectViewer</span><span class="operator">.</span><span class="name attribute">setModel</span><span class="operator">(</span><span class="name">nsAtt</span><span class="operator">);</span>
<span class="ln">107 </span>          <span class="name">nImageViewer</span><span class="operator">.</span><span class="name attribute">setModel</span><span class="operator">(</span><span class="name">niAtt</span><span class="operator">);</span>
<span class="ln">108 </span>       <span class="comment single">//
</span><span class="ln">109 </span><span class="comment single"></span>          <span class="name">nSpectViewer</span><span class="operator">.</span><span class="name attribute">setPreferredSize</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">Dimension</span><span class="operator">(</span><span class="literal number integer">400</span><span class="operator">,</span> <span class="literal number integer">300</span><span class="operator">));</span>
<span class="ln">110 </span>          <span class="name">nImageViewer</span><span class="operator">.</span><span class="name attribute">setPreferredSize</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">Dimension</span><span class="operator">(</span><span class="literal number integer">500</span><span class="operator">,</span> <span class="literal number integer">300</span><span class="operator">));</span>
<span class="ln">111 </span>          <span class="name">Gradient</span>  <span class="name">g</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Gradient</span><span class="operator">();</span>
<span class="ln">112 </span>          <span class="name">g</span><span class="operator">.</span><span class="name attribute">buidColorGradient</span><span class="operator">();</span>
<span class="ln">113 </span>          <span class="name">g</span><span class="operator">.</span><span class="name attribute">setColorAt</span><span class="operator">(</span><span class="literal number integer">0</span><span class="operator">,</span><span class="name">Color</span><span class="operator">.</span><span class="name attribute">black</span><span class="operator">);</span>
<span class="ln">114 </span>          <span class="name">nImageViewer</span><span class="operator">.</span><span class="name attribute">setGradient</span><span class="operator">(</span><span class="name">g</span><span class="operator">);</span>
<span class="ln">115 </span>          <span class="name">nImageViewer</span><span class="operator">.</span><span class="name attribute">setBestFit</span><span class="operator">(</span><span class="keyword constant">true</span><span class="operator">);</span>
<span class="ln">116 </span>
<span class="ln">117 </span>          <span class="comment single">//
</span><span class="ln">118 </span><span class="comment single"></span>          <span class="comment single">// Add the viewers into the frame to show them
</span><span class="ln">119 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">120 </span><span class="comment single"></span>          <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">setLayout</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">BorderLayout</span><span class="operator">());</span>
<span class="ln">121 </span>          <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">ssViewer</span><span class="operator">,</span> <span class="name">BorderLayout</span><span class="operator">.</span><span class="name attribute">SOUTH</span><span class="operator">);</span>
<span class="ln">122 </span>          <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">nSpectViewer</span><span class="operator">,</span> <span class="name">BorderLayout</span><span class="operator">.</span><span class="name attribute">CENTER</span><span class="operator">);</span>
<span class="ln">123 </span>          <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">nImageViewer</span><span class="operator">,</span> <span class="name">BorderLayout</span><span class="operator">.</span><span class="name attribute">EAST</span><span class="operator">);</span>
<span class="ln">124 </span>          <span class="comment single">//
</span><span class="ln">125 </span><span class="comment single"></span>          <span class="comment single">// To have the attributes values refreshed we should start the
</span><span class="ln">126 </span><span class="comment single"></span>          <span class="comment single">// attribute list's refresher.
</span><span class="ln">127 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">128 </span><span class="comment single"></span>          <span class="name">attributes</span><span class="operator">.</span><span class="name attribute">startRefresher</span><span class="operator">();</span>
<span class="ln">129 </span>          <span class="comment single">//
</span><span class="ln">130 </span><span class="comment single"></span>          <span class="comment single">// add the menubar to the frame
</span><span class="ln">131 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">132 </span><span class="comment single"></span>          <span class="name">setJMenuBar</span><span class="operator">(</span><span class="name">menu</span><span class="operator">);</span>
<span class="ln">133 </span>          <span class="comment single">//
</span><span class="ln">134 </span><span class="comment single"></span>          <span class="comment single">// JFrame stuff to make the thing show.
</span><span class="ln">135 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">136 </span><span class="comment single"></span>          <span class="name">pack</span><span class="operator">();</span>
<span class="ln">137 </span>          <span class="name">ATKGraphicsUtils</span><span class="operator">.</span><span class="name attribute">centerFrameOnScreen</span><span class="operator">(</span><span class="keyword">this</span><span class="operator">);</span> <span class="comment single">//ATK utility to center window
</span><span class="ln">138 </span><span class="comment single"></span>          <span class="name">setVisible</span><span class="operator">(</span><span class="keyword constant">true</span><span class="operator">);</span>
<span class="ln">139 </span>       <span class="operator">}</span>
<span class="ln">140 </span>       <span class="keyword declaration">public</span> <span class="keyword declaration">static</span> <span class="keyword type">void</span> <span class="name function">main</span><span class="operator">(</span><span class="name">String</span> <span class="operator">[]</span> <span class="name">args</span><span class="operator">)</span>
<span class="ln">141 </span>       <span class="operator">{</span>
<span class="ln">142 </span>          <span class="keyword">new</span> <span class="name">SecondApplication</span><span class="operator">();</span>
<span class="ln">143 </span>       <span class="operator">}</span>
<span class="ln">144 </span>       <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">quitItemActionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln">145 </span>       <span class="operator">{</span>
<span class="ln">146 </span>          <span class="name">System</span><span class="operator">.</span><span class="name attribute">exit</span><span class="operator">(</span><span class="literal number integer">0</span><span class="operator">);</span>
<span class="ln">147 </span>       <span class="operator">}</span>
<span class="ln">148 </span>       <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">errHistItemActionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln">149 </span>       <span class="operator">{</span>
<span class="ln">150 </span>          <span class="name">errorHistory</span><span class="operator">.</span><span class="name attribute">setVisible</span><span class="operator">(</span><span class="keyword constant">true</span><span class="operator">);</span>
<span class="ln">151 </span>       <span class="operator">}</span>
<span class="ln">152 </span>  <span class="operator">}</span>
</pre>
<div class="line-block">
<div class="line">This program (SeondApplication) should look something like this
(depending on your platform and your device attributes)</div>
<div class="line"><img alt="image12" src="../../_images/prog_guide_exple2.jpg" /></div>
</div>
</div>
<div class="section" id="synoptic-viewer">
<h4>Synoptic viewer<a class="headerlink" href="#synoptic-viewer" title="Permalink to this headline">¶</a></h4>
<p>TangoATK provides a generic class to view and to animate the synoptics.
The name of this class is
fr.esrf.tangoatk.widget.jdraw.SynopticFileViewer. This class is based on
a “home-made” graphical layer called jdraw. The jdraw package is also
included inside TangoATK distribution.</p>
<p>SynopticFileViewer is a sub-class of the class TangoSynopticHandler. All
the work for connection to tango devices and run time animation is done
inside the TangoSynopticHandler.</p>
<p>The recipe for using the TangoATK synoptic viewer is the following</p>
<ol class="arabic simple">
<li>You use Jdraw graphical editor to draw your synoptic</li>
<li>During drawing phase don’t forget to associate parts of the drawing
to tango attributes or commands. Use the “name” in the property
window to do this</li>
<li>During drawing phase you can also aasociate a class (frequently a
“specific panel” class) which will be displayed when the user clicks
on some part of the drawing. Use the “extension” tab in the property
window to do this.</li>
<li>Test the run-time behaviour of your synoptic. Use “Tango Synoptic
view” command in the “views” pulldown menu to do this.</li>
<li>Save the drawing file.</li>
<li>There is a simple synoptic application (SynopticAppli) which is
provided ready to use. If this generic application is enough for you,
you can forget about the step 7.</li>
<li>You can now develop a specific TangoATK based application which
instantiates the SynopticFileViewer. To load the synoptic file in the
SynopticFileViewer you have the choice : either you load it by giving
the absolute path name of the synoptic file or you load the synoptic
file using Java input streams. The second solution is used when the
synoptic file is included inside the application jarfile.</li>
</ol>
<p>The SynopticFilerViewer will browse the objects in the synoptic file at
run time. It discovers if some parts of the drawing is associated with
an attribute or a command. In this case it will automatically connect to
the corresponding attribute or command. Once the connection is
successful SynopticFileViewer will animate the synoptic according to
the default behaviour described below :</p>
<ul class="simple">
<li>For <em>tango state attributes</em> : the colour of the drawing object
reflects the value of the state. A mouse click on the drawing object
associated with the tango state attribute will instantiate and
display the class specified during the drawing phase. If no class is
specified the atkpanel generic device panel is displayed.</li>
<li>For <em>tango attributes</em> : the current value of the attribute is
displayed through the drawing object</li>
<li>For <em>tango commands</em> : the mouse click on the drawing object
associated with the command will launch the device command.</li>
<li>If the tooltip property is set to “name” when the mouse enters <em>any
tango object</em> ( attribute or command), inside the synoptic drawing
the name of the tango object is displayed in a tooltip.</li>
</ul>
<p>The following example (ThirdApplication), is a Synoptic application. We
assume that the synoptic has already been drawn using Jdraw graphical
editor.</p>
<pre class="code java literal-block">
<span class="ln">  1 </span>  <span class="keyword namespace">package</span> <span class="name namespace">examples</span><span class="operator">;</span>
<span class="ln">  2 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.io.*</span><span class="operator">;</span>
<span class="ln">  3 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.util.*</span><span class="operator">;</span>
<span class="ln">  4 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JFrame</span><span class="operator">;</span>
<span class="ln">  5 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenuItem</span><span class="operator">;</span>
<span class="ln">  6 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenuBar</span><span class="operator">;</span>
<span class="ln">  7 </span>  <span class="keyword namespace">import</span> <span class="name namespace">javax.swing.JMenu</span><span class="operator">;</span>
<span class="ln">  8 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.awt.event.ActionListener</span><span class="operator">;</span>
<span class="ln">  9 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.awt.event.ActionEvent</span><span class="operator">;</span>
<span class="ln"> 10 </span>  <span class="keyword namespace">import</span> <span class="name namespace">java.awt.BorderLayout</span><span class="operator">;</span>
<span class="ln"> 11 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.util.ErrorHistory</span><span class="operator">;</span>
<span class="ln"> 12 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.util.ATKGraphicsUtils</span><span class="operator">;</span>
<span class="ln"> 13 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.jdraw.SynopticFileViewer</span><span class="operator">;</span>
<span class="ln"> 14 </span>  <span class="keyword namespace">import</span> <span class="name namespace">fr.esrf.tangoatk.widget.jdraw.TangoSynopticHandler</span><span class="operator">;</span>
<span class="ln"> 15 </span>  <span class="keyword declaration">public</span> <span class="keyword declaration">class</span> <span class="name class">ThirdApplication</span> <span class="keyword declaration">extends</span> <span class="name">JFrame</span>
<span class="ln"> 16 </span>  <span class="operator">{</span>
<span class="ln"> 17 </span>       <span class="name">JMenuBar</span>              <span class="name">menu</span><span class="operator">;</span>
<span class="ln"> 18 </span>       <span class="name">ErrorHistory</span>          <span class="name">errorHistory</span><span class="operator">;</span>  <span class="comment single">// A window that displays errors
</span><span class="ln"> 19 </span><span class="comment single"></span>       <span class="name">SynopticFileViewer</span>    <span class="name">sfv</span><span class="operator">;</span>           <span class="comment single">// TangoATK generic synoptic viewer
</span><span class="ln"> 20 </span><span class="comment single"></span>
<span class="ln"> 21 </span>
<span class="ln"> 22 </span>       <span class="keyword declaration">public</span> <span class="name function">ThirdApplication</span><span class="operator">()</span>
<span class="ln"> 23 </span>       <span class="operator">{</span>
<span class="ln"> 24 </span>          <span class="comment single">// Swing stuff to create the menu bar and its pulldown menus
</span><span class="ln"> 25 </span><span class="comment single"></span>          <span class="name">menu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuBar</span><span class="operator">();</span>
<span class="ln"> 26 </span>          <span class="name">JMenu</span> <span class="name">fileMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="operator">();</span>
<span class="ln"> 27 </span>          <span class="name">fileMenu</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;File&quot;</span><span class="operator">);</span>
<span class="ln"> 28 </span>          <span class="name">JMenu</span> <span class="name">viewMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenu</span><span class="operator">();</span>
<span class="ln"> 29 </span>          <span class="name">viewMenu</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;View&quot;</span><span class="operator">);</span>
<span class="ln"> 30 </span>          <span class="name">JMenuItem</span> <span class="name">quitItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="operator">();</span>
<span class="ln"> 31 </span>          <span class="name">quitItem</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;Quit&quot;</span><span class="operator">);</span>
<span class="ln"> 32 </span>          <span class="name">quitItem</span><span class="operator">.</span><span class="name attribute">addActionListener</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">event</span><span class="operator">.</span><span class="name attribute">ActionListener</span><span class="operator">()</span>
<span class="ln"> 33 </span>                                        <span class="operator">{</span>
<span class="ln"> 34 </span>                                         <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">actionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln"> 35 </span>                                         <span class="operator">{</span><span class="name">quitItemActionPerformed</span><span class="operator">(</span><span class="name">evt</span><span class="operator">);}</span>
<span class="ln"> 36 </span>                                        <span class="operator">});</span>
<span class="ln"> 37 </span>          <span class="name">fileMenu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">quitItem</span><span class="operator">);</span>
<span class="ln"> 38 </span>          <span class="name">JMenuItem</span> <span class="name">errorHistItem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">JMenuItem</span><span class="operator">();</span>
<span class="ln"> 39 </span>          <span class="name">errorHistItem</span><span class="operator">.</span><span class="name attribute">setText</span><span class="operator">(</span><span class="literal string">&quot;Error History&quot;</span><span class="operator">);</span>
<span class="ln"> 40 </span>          <span class="name">errorHistItem</span><span class="operator">.</span><span class="name attribute">addActionListener</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">java</span><span class="operator">.</span><span class="name attribute">awt</span><span class="operator">.</span><span class="name attribute">event</span><span class="operator">.</span><span class="name attribute">ActionListener</span><span class="operator">()</span>
<span class="ln"> 41 </span>                  <span class="operator">{</span>
<span class="ln"> 42 </span>                   <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">actionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln"> 43 </span>                   <span class="operator">{</span><span class="name">errHistItemActionPerformed</span><span class="operator">(</span><span class="name">evt</span><span class="operator">);}</span>
<span class="ln"> 44 </span>                  <span class="operator">});</span>
<span class="ln"> 45 </span>          <span class="name">viewMenu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">errorHistItem</span><span class="operator">);</span>
<span class="ln"> 46 </span>          <span class="name">menu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">fileMenu</span><span class="operator">);</span>
<span class="ln"> 47 </span>          <span class="name">menu</span><span class="operator">.</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">viewMenu</span><span class="operator">);</span>
<span class="ln"> 48 </span>          <span class="comment single">//
</span><span class="ln"> 49 </span><span class="comment single"></span>          <span class="comment single">// Here we create TangoATK synoptic viewer and error window.
</span><span class="ln"> 50 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln"> 51 </span><span class="comment single"></span>          <span class="name">errorHistory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">ErrorHistory</span><span class="operator">();</span>
<span class="ln"> 52 </span>          <span class="name">sfv</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">SynopticFileViewer</span><span class="operator">();</span>
<span class="ln"> 53 </span>          <span class="keyword">try</span>
<span class="ln"> 54 </span>          <span class="operator">{</span>
<span class="ln"> 55 </span>              <span class="name">sfv</span><span class="operator">.</span><span class="name attribute">setErrorWindow</span><span class="operator">(</span><span class="name">errorHistory</span><span class="operator">);</span>
<span class="ln"> 56 </span>          <span class="operator">}</span>
<span class="ln"> 57 </span>          <span class="keyword">catch</span> <span class="operator">(</span><span class="name">Exception</span> <span class="name">setErrwExcept</span><span class="operator">)</span>
<span class="ln"> 58 </span>          <span class="operator">{</span>
<span class="ln"> 59 </span>              <span class="name">System</span><span class="operator">.</span><span class="name attribute">out</span><span class="operator">.</span><span class="name attribute">println</span><span class="operator">(</span><span class="literal string">&quot;Cannot set Error History Window&quot;</span><span class="operator">);</span>
<span class="ln"> 60 </span>          <span class="operator">}</span>
<span class="ln"> 61 </span>
<span class="ln"> 62 </span>          <span class="comment single">//
</span><span class="ln"> 63 </span><span class="comment single"></span>          <span class="comment single">// Here we define the name of the synoptic file to show and the tooltip mode to use
</span><span class="ln"> 64 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln"> 65 </span><span class="comment single"></span>          <span class="keyword">try</span>
<span class="ln"> 66 </span>          <span class="operator">{</span>
<span class="ln"> 67 </span>            <span class="name">sfv</span><span class="operator">.</span><span class="name attribute">setJdrawFileName</span><span class="operator">(</span><span class="literal string">&quot;/users/poncet/ATK_OLD/jdraw_files/id14.jdw&quot;</span><span class="operator">);</span>
<span class="ln"> 68 </span>            <span class="name">sfv</span><span class="operator">.</span><span class="name attribute">setToolTipMode</span> <span class="operator">(</span><span class="name">TangoSynopticHandler</span><span class="operator">.</span><span class="name attribute">TOOL_TIP_NAME</span><span class="operator">);</span>
<span class="ln"> 69 </span>          <span class="operator">}</span>
<span class="ln"> 70 </span>          <span class="keyword">catch</span> <span class="operator">(</span><span class="name">FileNotFoundException</span>  <span class="name">fnfEx</span><span class="operator">)</span>
<span class="ln"> 71 </span>          <span class="operator">{</span>
<span class="ln"> 72 </span>             <span class="name">javax</span><span class="operator">.</span><span class="name attribute">swing</span><span class="operator">.</span><span class="name attribute">JOptionPane</span><span class="operator">.</span><span class="name attribute">showMessageDialog</span><span class="operator">(</span>
<span class="ln"> 73 </span>                <span class="keyword constant">null</span><span class="operator">,</span> <span class="literal string">&quot;Cannot find the synoptic file : id14.jdw.\n&quot;</span>
<span class="ln"> 74 </span>                     <span class="operator">+</span> <span class="literal string">&quot;Check the file name you entered;&quot;</span>
<span class="ln"> 75 </span>                     <span class="operator">+</span> <span class="literal string">&quot; Application will abort ...\n&quot;</span>
<span class="ln"> 76 </span>                     <span class="operator">+</span> <span class="name">fnfEx</span><span class="operator">,</span>
<span class="ln"> 77 </span>                     <span class="literal string">&quot;No such file&quot;</span><span class="operator">,</span>
<span class="ln"> 78 </span>                     <span class="name">javax</span><span class="operator">.</span><span class="name attribute">swing</span><span class="operator">.</span><span class="name attribute">JOptionPane</span><span class="operator">.</span><span class="name attribute">ERROR_MESSAGE</span><span class="operator">);</span>
<span class="ln"> 79 </span>             <span class="name">System</span><span class="operator">.</span><span class="name attribute">exit</span><span class="operator">(-</span><span class="literal number integer">1</span><span class="operator">);</span>
<span class="ln"> 80 </span>          <span class="operator">}</span>
<span class="ln"> 81 </span>          <span class="keyword">catch</span> <span class="operator">(</span><span class="name">IllegalArgumentException</span>  <span class="name">illEx</span><span class="operator">)</span>
<span class="ln"> 82 </span>          <span class="operator">{</span>
<span class="ln"> 83 </span>             <span class="name">javax</span><span class="operator">.</span><span class="name attribute">swing</span><span class="operator">.</span><span class="name attribute">JOptionPane</span><span class="operator">.</span><span class="name attribute">showMessageDialog</span><span class="operator">(</span>
<span class="ln"> 84 </span>                <span class="keyword constant">null</span><span class="operator">,</span> <span class="literal string">&quot;Cannot parse the synoptic file : id14.jdw.\n&quot;</span>
<span class="ln"> 85 </span>                     <span class="operator">+</span> <span class="literal string">&quot;Check if the file is a Jdraw file.&quot;</span>
<span class="ln"> 86 </span>                     <span class="operator">+</span> <span class="literal string">&quot; Application will abort ...\n&quot;</span>
<span class="ln"> 87 </span>                     <span class="operator">+</span> <span class="name">illEx</span><span class="operator">,</span>
<span class="ln"> 88 </span>                     <span class="literal string">&quot;Cannot parse the file&quot;</span><span class="operator">,</span>
<span class="ln"> 89 </span>                     <span class="name">javax</span><span class="operator">.</span><span class="name attribute">swing</span><span class="operator">.</span><span class="name attribute">JOptionPane</span><span class="operator">.</span><span class="name attribute">ERROR_MESSAGE</span><span class="operator">);</span>
<span class="ln"> 90 </span>             <span class="name">System</span><span class="operator">.</span><span class="name attribute">exit</span><span class="operator">(-</span><span class="literal number integer">1</span><span class="operator">);</span>
<span class="ln"> 91 </span>          <span class="operator">}</span>
<span class="ln"> 92 </span>          <span class="keyword">catch</span> <span class="operator">(</span><span class="name">MissingResourceException</span>  <span class="name">mrEx</span><span class="operator">)</span>
<span class="ln"> 93 </span>          <span class="operator">{</span>
<span class="ln"> 94 </span>             <span class="name">javax</span><span class="operator">.</span><span class="name attribute">swing</span><span class="operator">.</span><span class="name attribute">JOptionPane</span><span class="operator">.</span><span class="name attribute">showMessageDialog</span><span class="operator">(</span>
<span class="ln"> 95 </span>                <span class="keyword constant">null</span><span class="operator">,</span> <span class="literal string">&quot;Cannot parse the synoptic file : id14.jdw.\n&quot;</span>
<span class="ln"> 96 </span>                     <span class="operator">+</span> <span class="literal string">&quot; Application will abort ...\n&quot;</span>
<span class="ln"> 97 </span>                     <span class="operator">+</span> <span class="name">mrEx</span><span class="operator">,</span>
<span class="ln"> 98 </span>                     <span class="literal string">&quot;Cannot parse the file&quot;</span><span class="operator">,</span>
<span class="ln"> 99 </span>                     <span class="name">javax</span><span class="operator">.</span><span class="name attribute">swing</span><span class="operator">.</span><span class="name attribute">JOptionPane</span><span class="operator">.</span><span class="name attribute">ERROR_MESSAGE</span><span class="operator">);</span>
<span class="ln">100 </span>             <span class="name">System</span><span class="operator">.</span><span class="name attribute">exit</span><span class="operator">(-</span><span class="literal number integer">1</span><span class="operator">);</span>
<span class="ln">101 </span>          <span class="operator">}</span>
<span class="ln">102 </span>          <span class="comment single">//
</span><span class="ln">103 </span><span class="comment single"></span>          <span class="comment single">// Add the viewers into the frame to show them
</span><span class="ln">104 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">105 </span><span class="comment single"></span>          <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">setLayout</span><span class="operator">(</span><span class="keyword">new</span> <span class="name">BorderLayout</span><span class="operator">());</span>
<span class="ln">106 </span>          <span class="name">getContentPane</span><span class="operator">().</span><span class="name attribute">add</span><span class="operator">(</span><span class="name">sfv</span><span class="operator">,</span> <span class="name">BorderLayout</span><span class="operator">.</span><span class="name attribute">CENTER</span><span class="operator">);</span>
<span class="ln">107 </span>          <span class="comment single">//
</span><span class="ln">108 </span><span class="comment single"></span>          <span class="comment single">// add the menubar to the frame
</span><span class="ln">109 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">110 </span><span class="comment single"></span>          <span class="name">setJMenuBar</span><span class="operator">(</span><span class="name">menu</span><span class="operator">);</span>
<span class="ln">111 </span>          <span class="comment single">//
</span><span class="ln">112 </span><span class="comment single"></span>          <span class="comment single">// JFrame stuff to make the thing show.
</span><span class="ln">113 </span><span class="comment single"></span>          <span class="comment single">//
</span><span class="ln">114 </span><span class="comment single"></span>          <span class="name">pack</span><span class="operator">();</span>
<span class="ln">115 </span>          <span class="name">ATKGraphicsUtils</span><span class="operator">.</span><span class="name attribute">centerFrameOnScreen</span><span class="operator">(</span><span class="keyword">this</span><span class="operator">);</span> <span class="comment single">//TangoATK utility to center window
</span><span class="ln">116 </span><span class="comment single"></span>          <span class="name">setVisible</span><span class="operator">(</span><span class="keyword constant">true</span><span class="operator">);</span>
<span class="ln">117 </span>       <span class="operator">}</span>
<span class="ln">118 </span>       <span class="keyword declaration">public</span> <span class="keyword declaration">static</span> <span class="keyword type">void</span> <span class="name function">main</span><span class="operator">(</span><span class="name">String</span> <span class="operator">[]</span> <span class="name">args</span><span class="operator">)</span>
<span class="ln">119 </span>       <span class="operator">{</span>
<span class="ln">120 </span>          <span class="keyword">new</span> <span class="name">ThirdApplication</span><span class="operator">();</span>
<span class="ln">121 </span>       <span class="operator">}</span>
<span class="ln">122 </span>       <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">quitItemActionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln">123 </span>       <span class="operator">{</span>
<span class="ln">124 </span>          <span class="name">System</span><span class="operator">.</span><span class="name attribute">exit</span><span class="operator">(</span><span class="literal number integer">0</span><span class="operator">);</span>
<span class="ln">125 </span>       <span class="operator">}</span>
<span class="ln">126 </span>       <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">errHistItemActionPerformed</span><span class="operator">(</span><span class="name">ActionEvent</span> <span class="name">evt</span><span class="operator">)</span>
<span class="ln">127 </span>       <span class="operator">{</span>
<span class="ln">128 </span>          <span class="name">errorHistory</span><span class="operator">.</span><span class="name attribute">setVisible</span><span class="operator">(</span><span class="keyword constant">true</span><span class="operator">);</span>
<span class="ln">129 </span>       <span class="operator">}</span>
<span class="ln">130 </span>  <span class="operator">}</span>
</pre>
<div class="line-block">
<div class="line">The synoptic application (ThirdApplication) should look something like
this (depending on your synoptic drawing file)</div>
<div class="line"><img alt="image13" src="../../_images/prog_guide_exple3.jpg" /></div>
</div>
</div>
</div>
<div class="section" id="a-short-note-on-the-relationship-between-models-and-viewers">
<h3>A short note on the relationship between models and viewers<a class="headerlink" href="#a-short-note-on-the-relationship-between-models-and-viewers" title="Permalink to this headline">¶</a></h3>
<p>As seen in the examples above, the connection between a model and its
viewer is generally done by calling <code class="docutils literal"><span class="pre">setModel(model)</span></code> on the viewer,
it is never explained what happens behind the scenes when this is done.</p>
<div class="section" id="listeners">
<h4>Listeners<a class="headerlink" href="#listeners" title="Permalink to this headline">¶</a></h4>
<p>Most of the viewers implement some sort of <em>listener</em> interface, eg
INumberScalarListener. An object implementing such a listener interface
has the capability of receiving and treating <em>events</em> from a model which
emits events.</p>
<pre class="code java literal-block">
<span class="ln"> 1 </span>  <span class="comment single">// this is the setModel of a SimpleScalarViewer
</span><span class="ln"> 2 </span><span class="comment single"></span>    <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">setModelsetModel</span><span class="operator">(</span><span class="name">INumberScalar</span> <span class="name">scalar</span><span class="operator">)</span> <span class="operator">{</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span>      <span class="name">clearModel</span><span class="operator">();</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>      <span class="keyword">if</span> <span class="operator">(</span><span class="name">scalar</span> <span class="operator">!=</span> <span class="keyword constant">null</span><span class="operator">)</span> <span class="operator">{</span>
<span class="ln"> 7 </span>        <span class="name">format</span> <span class="operator">=</span> <span class="name">scalar</span><span class="operator">.</span><span class="name attribute">getProperty</span><span class="operator">(</span><span class="literal string">&quot;format&quot;</span><span class="operator">).</span><span class="name attribute">getPresentation</span><span class="operator">();</span>
<span class="ln"> 8 </span>        <span class="name">numberModel</span> <span class="operator">=</span> <span class="name">scalar</span><span class="operator">;</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>     <span class="comment single">// this is where the viewer connects itself to the
</span><span class="ln">11 </span><span class="comment single"></span>     <span class="comment single">// model. After this the viewer will (hopefully) receive
</span><span class="ln">12 </span><span class="comment single"></span>     <span class="comment single">// events through its numberScalarChange() method
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>     <span class="name">numberModel</span><span class="operator">.</span><span class="name attribute">addNumberScalarListener</span><span class="operator">(</span><span class="keyword">this</span><span class="operator">);</span>
<span class="ln">15 </span>
<span class="ln">16 </span>
<span class="ln">17 </span>          <span class="name">numberModel</span><span class="operator">.</span><span class="name attribute">getProperty</span><span class="operator">(</span><span class="literal string">&quot;format&quot;</span><span class="operator">).</span><span class="name attribute">addPresentationListener</span><span class="operator">(</span><span class="keyword">this</span><span class="operator">);</span>
<span class="ln">18 </span>        <span class="name">numberModel</span><span class="operator">.</span><span class="name attribute">getProperty</span><span class="operator">(</span><span class="literal string">&quot;unit&quot;</span><span class="operator">).</span><span class="name attribute">addPresentationListener</span><span class="operator">(</span><span class="keyword">this</span><span class="operator">);</span>
<span class="ln">19 </span>      <span class="operator">}</span>
<span class="ln">20 </span>
<span class="ln">21 </span>    <span class="operator">}</span>
<span class="ln">22 </span>
<span class="ln">23 </span>
<span class="ln">24 </span>
<span class="ln">25 </span>  <span class="comment single">// Each time the model of this viewer (the numberscalar attribute) decides it is time, it
</span><span class="ln">26 </span><span class="comment single"></span>  <span class="comment single">// calls the numberScalarChange method of all its registered listeners
</span><span class="ln">27 </span><span class="comment single"></span>  <span class="comment single">// with a NumberScalarEvent object which contains the
</span><span class="ln">28 </span><span class="comment single"></span>  <span class="comment single">// the new value of the numberscalar attribute.
</span><span class="ln">29 </span><span class="comment single"></span>  <span class="comment single">//
</span><span class="ln">30 </span><span class="comment single"></span>
<span class="ln">31 </span>    <span class="keyword declaration">public</span> <span class="keyword type">void</span> <span class="name function">numberScalarChange</span><span class="operator">(</span><span class="name">NumberScalarEvent</span> <span class="name">evt</span><span class="operator">)</span> <span class="operator">{</span>
<span class="ln">32 </span>      <span class="name">String</span> <span class="name">val</span><span class="operator">;</span>
<span class="ln">33 </span>      <span class="name">val</span> <span class="operator">=</span> <span class="name">getDisplayString</span><span class="operator">(</span><span class="name">evt</span><span class="operator">);</span>
<span class="ln">34 </span>      <span class="keyword">if</span> <span class="operator">(</span><span class="name">unitVisible</span><span class="operator">)</span> <span class="operator">{</span>
<span class="ln">35 </span>        <span class="name">setText</span><span class="operator">(</span><span class="name">val</span> <span class="operator">+</span> <span class="literal string">&quot; &quot;</span> <span class="operator">+</span> <span class="name">numberModel</span><span class="operator">.</span><span class="name attribute">getUnit</span><span class="operator">());</span>
<span class="ln">36 </span>      <span class="operator">}</span> <span class="keyword">else</span> <span class="operator">{</span>
<span class="ln">37 </span>        <span class="name">setText</span><span class="operator">(</span><span class="name">val</span><span class="operator">);</span>
<span class="ln">38 </span>      <span class="operator">}</span>
<span class="ln">39 </span>    <span class="operator">}</span>
</pre>
<p>All listeners in TangoATK implement the <code class="docutils literal"><span class="pre">IErrorListener</span></code> interface
which specifies the <code class="docutils literal"><span class="pre">errorChange(ErrorEvent</span> <span class="pre">e)</span></code> method. This means
that all listeners are forced to handle errors in some way or another.</p>
</div>
</div>
</div>
<div class="section" id="the-key-objects-of-tangoatk">
<h2>The key objects of TangoATK<a class="headerlink" href="#the-key-objects-of-tangoatk" title="Permalink to this headline">¶</a></h2>
<p>As seen from the examples above, the key objects of TangoATK are the
<code class="docutils literal"><span class="pre">CommandList</span></code> and the <code class="docutils literal"><span class="pre">AttributeList</span></code>. These two classes inherit
from the abstract class <code class="docutils literal"><span class="pre">AEntityList</span></code> which implements all of the
common functionality between the two lists. These lists use the
functionality of the <code class="docutils literal"><span class="pre">CommandFactory</span></code>, the <code class="docutils literal"><span class="pre">AttributeFactory</span></code>, which
both derive from <code class="docutils literal"><span class="pre">AEntityFactory,</span></code> and the <code class="docutils literal"><span class="pre">DeviceFactory</span></code>.</p>
<p>In addition to these factories and lists there is one (for the time
being) other important functionality lurking around, the refreshers.</p>
<div class="section" id="the-refreshers">
<h3>The Refreshers<a class="headerlink" href="#the-refreshers" title="Permalink to this headline">¶</a></h3>
<p>The refreshers, represented in TangoATK by the <code class="docutils literal"><span class="pre">Refresher</span></code> object, is
simply a subclass of <code class="docutils literal"><span class="pre">java.lang.Thread</span></code> which will sleep for a given
amount of time and then call a method refresh on whatever kind of
<code class="docutils literal"><span class="pre">IRefreshee</span></code> it has been given as parameter, as shown below</p>
<pre class="code java literal-block">
<span class="ln">1 </span>  <span class="comment single">// This is an example from DeviceFactory.
</span><span class="ln">2 </span><span class="comment single"></span>  <span class="comment single">// We create a new Refresher with the name &quot;device&quot;
</span><span class="ln">3 </span><span class="comment single"></span>  <span class="comment single">// We add ourself to it, and start the thread
</span><span class="ln">4 </span><span class="comment single"></span>
<span class="ln">5 </span>
<span class="ln">6 </span>  <span class="name">Refresher</span> <span class="name">refresher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Refresher</span><span class="operator">(</span><span class="literal string">&quot;device&quot;</span><span class="operator">);</span>
<span class="ln">7 </span>  <span class="name">refresher</span><span class="operator">.</span><span class="name attribute">addRefreshee</span><span class="operator">(</span><span class="keyword">this</span><span class="operator">).</span><span class="name attribute">start</span><span class="operator">();</span>
</pre>
<p>Both the <code class="docutils literal"><span class="pre">AttributeList</span></code> and the <code class="docutils literal"><span class="pre">DeviceFactory</span></code> implement the
<code class="docutils literal"><span class="pre">IRefreshee</span></code> interface which specify only one method, <code class="docutils literal"><span class="pre">refresh()</span></code>,
and can thus be refreshed by the <code class="docutils literal"><span class="pre">Refresher</span></code>. Even if the new release
of TangoATK is based on the Tango Events, the refresher mecanisme will
not be removed. As a matter of fact, the method refresh() implemented in
AttributeList skips all attributes (members of the list) for which the
subscribe to the tango event has succeeded and calls the old refresh()
method for the others (for which subscribe to tango events has failed).</p>
<p>In a first stage this will allow the TangoATK applications to mix the
use of the old tango device servers (which do not implement tango
events) and the new ones in the same code. In other words, TangoATK
subscribes for tango events if possible otherwise TangoATK will refresh
the attributes through the old refresher mecanisme.</p>
<p>Another reason for keeping the refresher is that the subscribe event can
fail even for the attributes of the new Tango device servers. As soon as
the specified attribute is not polled the Tango events cannot be
generated for that attribute. Therefore the event subscription will
fail. In this case the attribute will be refreshed thanks to the ATK
attribute list refresher.</p>
<p>The <code class="docutils literal"><span class="pre">AttributePolledList</span></code> class allows the application programmer to
force explicitly the use of the refresher method for all attributes
added in an AttributePolledList even if the corresponding device servers
implement tango events. Some viewers
(fr.esrf.tangoatk.widget.attribute.Trend) need an AttributePolledList in
order to force the refresh of the attribute without using tango events.</p>
<div class="section" id="what-happens-on-a-refresh">
<h4>What happens on a refresh<a class="headerlink" href="#what-happens-on-a-refresh" title="Permalink to this headline">¶</a></h4>
<p>When <code class="docutils literal"><span class="pre">refresh</span></code> is called on the <code class="docutils literal"><span class="pre">AttributeList</span></code> and the
<code class="docutils literal"><span class="pre">DeviceFactory</span></code>, they loop through their objects, <code class="docutils literal"><span class="pre">IAttributes</span></code> and
<code class="docutils literal"><span class="pre">IDevices</span></code>, respectively, and ask them to refresh themselves if they
are not event driven.</p>
<p>When AttributeFactory, creates an <code class="docutils literal"><span class="pre">IAttribute</span></code>, TangoATK tries to
subscribe for Tango Change event for that attribute. If the subscription
succeeds then the attribute is marked as event driven. If the
subscription for Tango Change event fails, TangoATK tries to subscribe
for Tango Periodic event. If the subscription succeeds then the
attribute is marked as event driven. If the subscription fails then the
attribute is marked as to be “ without events”.</p>
<p>In the refresh() method of the AttributeList during the loop through the
objects if the object is marked event driven then the object is simply
skipped. But if the object (attribute) is not marked as event driven,
the refresh() method of the AttributeList, asks the object to refresh
itself by calling the “refresh()” method of that object (attribute or
device). The refresh() method of an attribute will in turn call the
“readAttribute” on the Tango device.</p>
<p>The result of this is that the <code class="docutils literal"><span class="pre">IAttributes</span></code> fire off events to their
registered listeners containing snapshots of their state. The events are
fired either because the IAttribute has received a Tango Change event,
respectively a Tango Periodic event (event driven objects), or because
the refresh() method of the object has issued a readAttribute on the
Tango device.</p>
</div>
</div>
<div class="section" id="the-devicefactory">
<h3>The DeviceFactory<a class="headerlink" href="#the-devicefactory" title="Permalink to this headline">¶</a></h3>
<p>The device factory is responsible for two things</p>
<ol class="arabic simple">
<li>Creating new devices (Tango device proxies) when needed</li>
<li>Refreshing the state and status of these devices</li>
</ol>
<p>Regarding the first point, new devices are created when they are asked
for and only if they have not already been created. If a programmer asks
for the same device twice, she is returned a reference to the same
device-object.</p>
<p>The <code class="docutils literal"><span class="pre">DeviceFactory</span></code> contains a Refresher as described above, which
makes sure that the all in the updates their state and status and fire
events to its listeners.</p>
</div>
<div class="section" id="the-attributefactory-and-the-commandfactory">
<h3>The AttributeFactory and the CommandFactory<a class="headerlink" href="#the-attributefactory-and-the-commandfactory" title="Permalink to this headline">¶</a></h3>
<p>These factories are responsible for taking a name of an attribute or
command and returning an object representing the attribute or command.
It is also responsible for making sure that the appropriate <code class="docutils literal"><span class="pre">IDevice</span></code>
is already available. Normally the programmer does not want to use these
factory classes directly. They are used by TangoATK classes indirectly
when the application programmer calls the AttributeList’s (or
CommandList’s) add() method.</p>
</div>
<div class="section" id="the-attributelist-and-the-commandlist">
<h3>The AttributeList and the CommandList<a class="headerlink" href="#the-attributelist-and-the-commandlist" title="Permalink to this headline">¶</a></h3>
<p>These lists are containers for attributes and commands. They delegate
the construction-work to the factories mentioned above, and generally do
not do much more, apart from containing refreshers, and thus being able
to make the objects they contain refresh their listeners.</p>
</div>
<div class="section" id="the-attributes">
<h3>The Attributes<a class="headerlink" href="#the-attributes" title="Permalink to this headline">¶</a></h3>
<p>The attributes come in several flavors. Tango supports the following
types:</p>
<ul class="simple">
<li>Short</li>
<li>Long</li>
<li>Double</li>
<li>String</li>
<li>Unsigned Char</li>
<li>Boolean</li>
<li>Unsigned Short</li>
<li>Float</li>
<li>Unsigned Long</li>
</ul>
<p>According to Tango specifications, all these types can be of the
following formats:</p>
<ul class="simple">
<li>Scalar, a single value</li>
<li>Spectrum, a single array</li>
<li>Image, a two dimensional array</li>
</ul>
<p>For the sake of simplicity, TangoATK has combined all the numeric types
into one, presenting all of them as doubles. So the TangoATK classes
which handle the numeric attributes are : NumberScalar, NumberSpectrum
and NumberImage (Number can be short, long, double, float, …).</p>
<div class="section" id="the-hierarchy">
<h4>The hierarchy<a class="headerlink" href="#the-hierarchy" title="Permalink to this headline">¶</a></h4>
<p>The numeric attribute hierarchy is expressed in the following
interfaces:</p>
<p><code class="docutils literal"><span class="pre">INumberScalar</span></code> extends <code class="docutils literal"><span class="pre">INumber</span></code></p>
<p><code class="docutils literal"><span class="pre">INumberSpectrum</span></code> extends <code class="docutils literal"><span class="pre">INumber</span></code></p>
<p><code class="docutils literal"><span class="pre">INumberImage</span></code> extends <code class="docutils literal"><span class="pre">INumber</span></code></p>
<p><code class="docutils literal"><span class="pre">INumber</span></code> in turn extends <code class="docutils literal"><span class="pre">IAttribute</span></code></p>
<p>Each of these types emit their proper events and have their proper
listeners. Please consult the javadoc for further information.</p>
</div>
</div>
<div class="section" id="the-commands">
<h3>The Commands<a class="headerlink" href="#the-commands" title="Permalink to this headline">¶</a></h3>
<p>The commands in Tango are rather ugly beasts. There exists the following
kinds of commands</p>
<ul class="simple">
<li>Those which take input</li>
<li>Those which do not take input</li>
<li>Those which do output</li>
<li>Those which do not do output</li>
</ul>
<p>Now, for both input and output we have the following types:</p>
<ul class="simple">
<li>Double</li>
<li>Float</li>
<li>Unsigned Long</li>
<li>Long</li>
<li>Unsigned Short</li>
<li>Short</li>
<li>String</li>
</ul>
<p>These types can appear in scalar or array formats. In addition to this,
there are also four other types of parameters:</p>
<ol class="arabic simple">
<li>Boolean</li>
<li>Unsigned Char Array</li>
<li>The StringLongArray</li>
<li>The StringDoubleArray</li>
</ol>
<p>The last two types mentioned above are two-dimensional arrays containing
a string array in the first dimension and a long or double array in the
second dimension, respectively.</p>
<p>As for the attributes, all numeric types have been converted into
doubles, but there has been made little or no effort to create an
hierarchy of types for the commands.</p>
<div class="section" id="events-and-listeners">
<h4>Events and listeners<a class="headerlink" href="#events-and-listeners" title="Permalink to this headline">¶</a></h4>
<p>The commands publish results to their <code class="docutils literal"><span class="pre">IResultListener</span></code>s, by the
means of a <code class="docutils literal"><span class="pre">ResultEvent</span></code>. The <code class="docutils literal"><span class="pre">IResultListener</span></code> extends
<code class="docutils literal"><span class="pre">IErrorListener</span></code>, any viewer of command-results should also know how
to handle errors. So a viewer of command-results implements
IResultListener interface and registers itself as a resultListener for
the command it has to show the results.</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../device-api/python/index.html" class="btn btn-neutral float-right" title="PyTango - a Python binding to Tango" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cpp-client-programmers-guide.html" class="btn btn-neutral" title="Writing a TANGO client using TANGO C++ APIs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tango Community, Creative Commons Attribution 4.0 International (CC BY 4.0).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'9.2.5',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>