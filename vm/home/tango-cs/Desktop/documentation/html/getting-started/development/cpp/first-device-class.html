

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Your first C++ TANGO device class &mdash; Tango Controls 9.2.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Tango Controls 9.2.5 documentation" href="../../../index.html"/>
        <link rel="up" title="Getting started with cppTango (C++ implementation of Tango-Controls)" href="index.html"/>
        <link rel="next" title="Getting started with PyTango (Python implementation of Tango-Controls)" href="../python/index.html"/>
        <link rel="prev" title="Writing your first C++ TANGO client" href="first-client.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../contents.html" class="icon icon-home"> Tango Controls
          

          
            
            <img src="../../../_static/logo_tangocontrols_white.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                9.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to Tango Controls documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../first-steps.html">First steps with Tango Controls</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../end-user/index.html">End-user applications guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">How to develop for Tango Controls</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../java/index.html">Getting started with JTango (Java implementation of Tango-Controls)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Getting started with cppTango (C++ implementation of Tango-Controls)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="first-client.html">Writing your first C++ TANGO client</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Your first C++ TANGO device class</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../python/index.html">Getting started with PyTango (Python implementation of Tango-Controls)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../administration/index.html">Administration applications guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools-and-extensions/index.html">Tools and Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../administration/index.html">Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials-and-howtos/index.html">Tutorials and How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../contents.html">Tango Controls</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Getting Started</a> &raquo;</li>
        
          <li><a href="../index.html">How to develop for Tango Controls</a> &raquo;</li>
        
          <li><a href="index.html">Getting started with cppTango (C++ implementation of Tango-Controls)</a> &raquo;</li>
        
      <li>Your first C++ TANGO device class</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/getting-started/development/cpp/first-device-class.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="your-first-c-tango-device-class">
<h1>Your first C++ TANGO device class<a class="headerlink" href="#your-first-c-tango-device-class" title="Permalink to this headline">¶</a></h1>
<p>The code given in this chapter as example has been generated using POGO.
Pogo is a code generator for Tango device server. See
<a class="reference external" href="http://www.esrf.eu/computing/cs/tango/tango_doc/tools_doc/pogo_doc/index.html">POGO home page</a> for more information about POGO. The
following examples briefly describe how to write device class with
commands which receives and return different kind of Tango data types
and also how to write device attributes The device class implements 5
commands and 3 attributes. The commands are :</p>
<ul class="simple">
<li>The command <strong>DevSimple</strong> deals with simple Tango data type</li>
<li>The command <strong>DevString</strong> deals with Tango strings</li>
<li><strong>DevArray</strong> receive and return an array of simple Tango data type</li>
<li><strong>DevStrArray</strong> which does not receive any data but which returns an
array of strings</li>
<li><strong>DevStruct</strong> which also does not receive data but which returns one
of the two Tango composed types (DevVarDoubleStringArray)</li>
</ul>
<p>For all these commands, the default behavior of the state machine
(command always allowed) is acceptable. The attributes are :</p>
<ul class="simple">
<li>A spectrum type attribute of the Tango string type called <strong>StrAttr</strong></li>
<li>A readable attribute of the Tango::DevLong type called
<strong>LongRdAttr</strong>. This attribute is linked with the following writable
attribute</li>
<li>A writable attribute also of the Tango::DevLong type called
<strong>LongWrAttr</strong>.</li>
</ul>
<p>Since release 9, a Tango device also supports pipe. This is an advanced
feature reserved for some specific cases. Therefore, there is no device
pipe example in this Getting started chapter.</p>
<div class="section" id="the-commands-and-attributes-code">
<h2>The commands and attributes code<a class="headerlink" href="#the-commands-and-attributes-code" title="Permalink to this headline">¶</a></h2>
<p>For each command called DevXxxx, pogo generates in the device class a
method named dev_xxx which will be executed when the command is
requested by a client. In this chapter, the name of the device class is
<em>DocDs</em></p>
<div class="section" id="the-devsimple-command">
<h3>The DevSimple command<a class="headerlink" href="#the-devsimple-command" title="Permalink to this headline">¶</a></h3>
<p>This method receives a Tango::DevFloat type and also returns a data of
the Tango::DevFloat type which is simply the double of the input value.
The code for the method executed by this command is the following:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevFloat</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_simple</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevFloat</span> <span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevFloat</span> <span class="name">argout</span> <span class="punctuation">;</span>
<span class="ln"> 4 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_simple(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 5 </span>
<span class="ln"> 6 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln"> 7 </span><span class="comment single"></span>
<span class="ln"> 8 </span>          <span class="name">argout</span> <span class="operator">=</span> <span class="name">argin</span> <span class="operator">*</span> <span class="literal number integer">2</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">10 </span>  <span class="punctuation">}</span>
</pre>
<p>This method is fairly simple. The received data is passed to the method
as its argument. It is</p>
<p>doubled at line 8 and the method simply returns the result.</p>
</div>
<div class="section" id="the-devarray-command">
<h3>The DevArray command<a class="headerlink" href="#the-devarray-command" title="Permalink to this headline">¶</a></h3>
<p>This method receives a data of the Tango::DevVarLongArray type and also
returns a data of the Tango::DevVarLongArray type. Each element of the
array is doubled. The code for the method executed by the command is the
following :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="operator">*</span><span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_array</span><span class="punctuation">(</span><span class="keyword">const</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span> <span class="operator">*</span><span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span>  <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarLongArray</span><span class="punctuation">();</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_array(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">11 </span>
<span class="ln">12 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>          <span class="keyword type">long</span> <span class="name">argin_length</span> <span class="operator">=</span> <span class="name">argin</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">();</span>
<span class="ln">15 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="name">argin_length</span><span class="punctuation">);</span>
<span class="ln">16 </span>          <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">int</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">argin_length</span><span class="punctuation">;</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln">17 </span>                  <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="operator">*</span><span class="name">argin</span><span class="punctuation">)[</span><span class="name">i</span><span class="punctuation">]</span> <span class="operator">*</span> <span class="literal number integer">2</span><span class="punctuation">;</span>
<span class="ln">18 </span>
<span class="ln">19 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">20 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout data array is created at line 8. Its length is set at line 15
from the input argument length. The array is populated at line 16,17 and
returned. This method allocates memory for the argout array. This memory
is freed by the Tango core classes after the data have been sent to the
caller (no delete is needed). It is also possible to return data from a
statically allocated array without copying. Look at chapter [Data
exchange] for all the details.</p>
</div>
<div class="section" id="the-devstring-command">
<h3>The DevString command<a class="headerlink" href="#the-devstring-command" title="Permalink to this headline">¶</a></h3>
<p>This method receives a data of the Tango::DevString type and also
returns a data of the Tango::DevString type. The command simply displays
the content of the input string and returns a hard-coded string. The
code for the method executed by the command is the following :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_string</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span> <span class="name">argin</span><span class="punctuation">)</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span>        <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln"> 9 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_string(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">10 </span>
<span class="ln">11 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">12 </span><span class="comment single"></span>
<span class="ln">13 </span>          <span class="name">cout</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;the received string is &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">argin</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">14 </span>
<span class="ln">15 </span>          <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Am I a good Tango dancer ?&quot;</span><span class="punctuation">);</span>
<span class="ln">16 </span>          <span class="name">argout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="keyword type">char</span><span class="punctuation">[</span><span class="name">str</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">()</span> <span class="operator">+</span> <span class="literal number integer">1</span><span class="punctuation">];</span>
<span class="ln">17 </span>          <span class="name">strcpy</span><span class="punctuation">(</span><span class="name">argout</span><span class="punctuation">,</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">18 </span>
<span class="ln">19 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">20 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout string is created at line 8. Internally, this method is using
a standard C++ string. Memory for the returned data is allocated at line
16 and is initialized at line 17. This method allocates memory for the
argout string. This memory is freed by the Tango core classes after the
data have been sent to the caller (no delete is needed). It is also
possible to return data from a statically allocated string without
copying. Look at chapter [Data exchange] for all the details.</p>
</div>
<div class="section" id="the-devstrarray-command">
<h3>The DevStrArray command<a class="headerlink" href="#the-devstrarray-command" title="Permalink to this headline">¶</a></h3>
<p>This method does not receive input data but returns an array of strings
(Tango::DevVarStringArray type). The code for the method executed by
this command is the following:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span> <span class="operator">*</span><span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_str_array</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span>        <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarStringArray</span><span class="punctuation">();</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_str_array(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">11 </span>
<span class="ln">12 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln">15 </span>          <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Rumba&quot;</span><span class="punctuation">);</span>
<span class="ln">16 </span>          <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Waltz&quot;</span><span class="punctuation">);</span>
<span class="ln">17 </span>          <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Jerck&quot;</span><span class="punctuation">);</span>
<span class="ln">18 </span>          <span class="punctuation">(</span><span class="operator">*</span><span class="name">argout</span><span class="punctuation">)[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">19 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">20 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout data array is created at line 8. Its length is set at line
14. The array is populated at line 15,16 and 18. The last array element
is initialized from a standard C++ string created at line 17. Note the
usage of the <em>string_dup</em> function of the CORBA namespace. This is
necessary for strings array due to the CORBA memory allocation schema.</p>
</div>
<div class="section" id="the-devstruct-command">
<h3>The DevStruct command<a class="headerlink" href="#the-devstruct-command" title="Permalink to this headline">¶</a></h3>
<p>This method does not receive input data but returns a structure of the
Tango::DevVarDoubleStringArray type. This type is a composed type with
an array of double and an array of strings. The code for the method
executed by this command is the following:</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span>  <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarDoubleStringArray</span> <span class="operator">*</span><span class="name">DocDs</span><span class="operator">::</span><span class="name">dev_struct</span><span class="punctuation">()</span>
<span class="ln"> 2 </span>  <span class="punctuation">{</span>
<span class="ln"> 3 </span>          <span class="comment single">//      POGO has generated a method core with argout allocation.
</span><span class="ln"> 4 </span><span class="comment single"></span>          <span class="comment single">//      If you would like to use a static reference without copying,
</span><span class="ln"> 5 </span><span class="comment single"></span>          <span class="comment single">//      See &quot;TANGO Device Server Programmer's Manual&quot;
</span><span class="ln"> 6 </span><span class="comment single"></span>          <span class="comment single">//              (chapter x.x)
</span><span class="ln"> 7 </span><span class="comment single"></span>          <span class="comment single">//------------------------------------------------------------
</span><span class="ln"> 8 </span><span class="comment single"></span>          <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarDoubleStringArray</span>  <span class="operator">*</span><span class="name">argout</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="name">Tango</span><span class="operator">::</span><span class="name">DevVarDoubleStringArray</span><span class="punctuation">();</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span>          <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::dev_struct(): entering... !&quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">11 </span>
<span class="ln">12 </span>          <span class="comment single">//      Add your own code to control device here
</span><span class="ln">13 </span><span class="comment single"></span>
<span class="ln">14 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">);</span>
<span class="ln">15 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">0.0</span><span class="punctuation">;</span>
<span class="ln">16 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">11.11</span><span class="punctuation">;</span>
<span class="ln">17 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">dvalue</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal number float">22.22</span><span class="punctuation">;</span>
<span class="ln">18 </span>
<span class="ln">19 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">svalue</span><span class="punctuation">.</span><span class="name">length</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln">20 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">svalue</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="literal string">&quot;Be Bop&quot;</span><span class="punctuation">);</span>
<span class="ln">21 </span>          <span class="name">string</span> <span class="name function">str</span><span class="punctuation">(</span><span class="literal string">&quot;Smurf&quot;</span><span class="punctuation">);</span>
<span class="ln">22 </span>          <span class="name">argout</span><span class="operator">-&gt;</span><span class="name">svalue</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">CORBA</span><span class="operator">::</span><span class="name">string_dup</span><span class="punctuation">(</span><span class="name">str</span><span class="punctuation">.</span><span class="name">c_str</span><span class="punctuation">());</span>
<span class="ln">23 </span>
<span class="ln">24 </span>          <span class="keyword">return</span> <span class="name">argout</span><span class="punctuation">;</span>
<span class="ln">25 </span>  <span class="punctuation">}</span>
</pre>
<p>The argout data structure is created at line 8. The length of the double
array in the output structure is set at line 14. The array is populated
between lines 15 and 17. The length of the string array in the output
structure is set at line 19. This string array is populated between
lines 20 an 22 from a hard-coded string and from a standard C++ string.
This method allocates memory for the argout data. This memory is freed
by the Tango core classes after the data have been sent to the caller
(no delete is needed). Note the usage of the <em>string_dup</em> function of
the CORBA namespace. This is necessary for strings array due to the
CORBA memory allocation schema.</p>
</div>
<div class="section" id="the-three-attributes">
<h3>The three attributes<a class="headerlink" href="#the-three-attributes" title="Permalink to this headline">¶</a></h3>
<p>Some data have been added to the definition of the device class in order
to store attributes value. These data are (part of the class definition)
:</p>
<pre class="code cpp literal-block">
<span class="ln">1 </span> <span class="keyword">protected</span> <span class="operator">:</span>
<span class="ln">2 </span>         <span class="comment single">//      Add your own data members here
</span><span class="ln">3 </span><span class="comment single"></span>         <span class="comment single">//-----------------------------------------
</span><span class="ln">4 </span><span class="comment single"></span>         <span class="name">Tango</span><span class="operator">::</span><span class="name">DevString</span>        <span class="name">attr_str_array</span><span class="punctuation">[</span><span class="literal number integer">5</span><span class="punctuation">];</span>
<span class="ln">5 </span>         <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span>          <span class="name">attr_rd</span><span class="punctuation">;</span>
<span class="ln">6 </span>         <span class="name">Tango</span><span class="operator">::</span><span class="name">DevLong</span>          <span class="name">attr_wr</span><span class="punctuation">;</span>
</pre>
<p>One data has been created for each attribute. As the StrAttr attribute
is of type spectrum with a maximum X dimension of 5, an array of length
5 has been reserved.</p>
<p>Several methods are necessary to implement these attributes. One method
to read the hardware which is common to all readable attributes plus one
read method for each readable attribute and one write method for each
writable attribute. The code for these methods is the following :</p>
<pre class="code cpp literal-block">
<span class="ln"> 1 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_attr_hardware</span><span class="punctuation">(</span><span class="name">vector</span><span class="operator">&lt;</span><span class="keyword type">long</span><span class="operator">&gt;</span> <span class="operator">&amp;</span><span class="name">attr_list</span><span class="punctuation">)</span>
<span class="ln"> 2 </span> <span class="punctuation">{</span>
<span class="ln"> 3 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_attr_hardware(vector&lt;long&gt; &amp;attr_list) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln"> 4 </span> <span class="comment single">// Add your own code here
</span><span class="ln"> 5 </span><span class="comment single"></span>
<span class="ln"> 6 </span>     <span class="name">string</span> <span class="name">att_name</span><span class="punctuation">;</span>
<span class="ln"> 7 </span>     <span class="keyword">for</span> <span class="punctuation">(</span><span class="keyword type">long</span> <span class="name">i</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">;</span><span class="name">i</span> <span class="operator">&lt;</span> <span class="name">attr_list</span><span class="punctuation">.</span><span class="name">size</span><span class="punctuation">();</span><span class="name">i</span><span class="operator">++</span><span class="punctuation">)</span>
<span class="ln"> 8 </span>     <span class="punctuation">{</span>
<span class="ln"> 9 </span>         <span class="name">att_name</span> <span class="operator">=</span> <span class="name">dev_attr</span><span class="operator">-&gt;</span><span class="name">get_attr_by_ind</span><span class="punctuation">(</span><span class="name">attr_list</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">]).</span><span class="name">get_name</span><span class="punctuation">();</span>
<span class="ln">10 </span>
<span class="ln">11 </span>        <span class="keyword">if</span> <span class="punctuation">(</span><span class="name">att_name</span> <span class="operator">==</span> <span class="literal string">&quot;LongRdAttr&quot;</span><span class="punctuation">)</span>
<span class="ln">12 </span>        <span class="punctuation">{</span>
<span class="ln">13 </span>            <span class="name">attr_rd</span> <span class="operator">=</span> <span class="literal number integer">5</span><span class="punctuation">;</span>
<span class="ln">14 </span>        <span class="punctuation">}</span>
<span class="ln">15 </span>    <span class="punctuation">}</span>
<span class="ln">16 </span> <span class="punctuation">}</span>
<span class="ln">17 </span>
<span class="ln">18 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_LongRdAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">19 </span> <span class="punctuation">{</span>
<span class="ln">20 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_LongRdAttr(Tango::Attribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">21 </span>
<span class="ln">22 </span>     <span class="name">attr</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">attr_rd</span><span class="punctuation">);</span>
<span class="ln">23 </span> <span class="punctuation">}</span>
<span class="ln">24 </span>
<span class="ln">25 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_LongWrAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">26 </span> <span class="punctuation">{</span>
<span class="ln">27 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_LongWrAttr(Tango::Attribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">28 </span>
<span class="ln">29 </span>     <span class="name">attr</span><span class="punctuation">.</span><span class="name">set_value</span><span class="punctuation">(</span><span class="operator">&amp;</span><span class="name">attr_wr</span><span class="punctuation">);</span>
<span class="ln">30 </span> <span class="punctuation">}</span>
<span class="ln">31 </span>
<span class="ln">32 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">write_LongWrAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">WAttribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">33 </span> <span class="punctuation">{</span>
<span class="ln">34 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::write_LongWrAttr(Tango::WAttribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">35 </span>
<span class="ln">36 </span>     <span class="name">attr</span><span class="punctuation">.</span><span class="name">get_write_value</span><span class="punctuation">(</span><span class="name">attr_wr</span><span class="punctuation">);</span>
<span class="ln">37 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;Value to be written = &quot;</span> <span class="operator">&lt;&lt;</span> <span class="name">attr_wr</span> <span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">38 </span> <span class="punctuation">}</span>
<span class="ln">39 </span>
<span class="ln">40 </span> <span class="keyword type">void</span> <span class="name">DocDs</span><span class="operator">::</span><span class="name">read_StrAttr</span><span class="punctuation">(</span><span class="name">Tango</span><span class="operator">::</span><span class="name">Attribute</span> <span class="operator">&amp;</span><span class="name">attr</span><span class="punctuation">)</span>
<span class="ln">41 </span> <span class="punctuation">{</span>
<span class="ln">42 </span>     <span class="name">DEBUG_STREAM</span> <span class="operator">&lt;&lt;</span> <span class="literal string">&quot;DocDs::read_StrAttr(Tango::Attribute &amp;attr) entering... &quot;</span><span class="operator">&lt;&lt;</span> <span class="name">endl</span><span class="punctuation">;</span>
<span class="ln">43 </span>
<span class="ln">44 </span>     <span class="name">attr_str_array</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="keyword">const_cast</span><span class="operator">&lt;</span><span class="keyword type">char</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="literal string">&quot;Rock&quot;</span><span class="punctuation">);</span>
<span class="ln">45 </span>     <span class="name">attr_str_array</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="keyword">const_cast</span><span class="operator">&lt;</span><span class="keyword type">char</span> <span class="operator">*&gt;</span><span class="punctuation">(</span><span class="literal string">&quot;Samba&quot;</span><span class="punctuation">);</span>
<span class="ln">46 </span>
<span class="ln">47 </span>     <span class="name">attr_set_value</span><span class="punctuation">(</span><span class="name">attr_str_array</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">);</span>
<span class="ln">48 </span> <span class="punctuation">}</span>
</pre>
<p>The <em>read_attr_hardware()</em> method is executed once when a client
execute the read_attributes CORBA request whatever the number of
attribute to be read is. The rule of this method is to read the hardware
and to store the read values somewhere in the device object. In our
example, only the LongRdAttr attribute internal value is set by this
method at line 13. The method <em>read_LongRdAttr()</em> is executed by the
read_attributes CORBA call when the LongRdAttr attribute is read but
after the read_attr_hardware() method has been executed. Its rule is
to set the attribute value in the TANGO core classes object representing
the attribute. This is done at line 22. The method <em>read_LongWrAttr()</em>
will be executed when the LongWrAttr attribute is read (after the
<em>read_attr_hardware()</em> method). The attribute value is set at line 29.
In the same manner, the method called <em>read_StrAttr()</em> will be executed
when the attribute StrAttr is read. Its value is initialized in this
method at line 44 and 45 with the <em>string_dup</em> Tango function. There
are several ways to code spectrum or image attribute of the DevString
data type. A HowTo related to this topic is available on the Tango
control system Web site. The <em>write_LongWrAttr()</em> method is executed
when the LongWrAttr attribute value is set by a client. The new
attribute value coming from the client is stored in the object data at
line 36.</p>
<p>Pogo also generates a file called DocDsStateMachine.cpp (for a Tango
device server class called DocDs). This file is used to store methods
coding the device state machine. By default a allways allowed state
machine is provided. For more information about coding the state
machine, refer to the chapter Writing a device server.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../python/index.html" class="btn btn-neutral float-right" title="Getting started with PyTango (Python implementation of Tango-Controls)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="first-client.html" class="btn btn-neutral" title="Writing your first C++ TANGO client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Tango Community, Creative Commons Attribution 4.0 International (CC BY 4.0).

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'9.2.5',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>